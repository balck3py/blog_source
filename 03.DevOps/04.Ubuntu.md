---
title: Ubuntu常用命令
date: 2025-12-15
author: Eugen
tags:
  - Ubuntu
  - Linux
  - 系统管理
  - 权限管理
  - sudo
  - su
  - DNS
  - 网络配置
---

## 常用命令

##### 切换账号

| 命令             | 需要密码    | 环境变化       | 切换到目录   | 常用场景                 |
| -------------- | ------- | ---------- | ------- | -------------------- |
| `su -`         | root 密码 | 完整 root 环境 | `/root` | 需要完全 root 环境工作       |
| `su root`      | root 密码 | 原用户环境      | 当前目录    | 临时执行 root 命令         |
| `sudo -i`      | 用户自己的密码 | 完整 root 环境 | `/root` | Ubuntu 推荐方式          |
| `sudo -s`      | 用户自己的密码 | 混合环境       | 当前目录    | 保留部分环境               |
| `sudo command` | 用户自己的密码 | 不切换用户      | 不切换目录   | 单条命令提权               |
| `sudo su`      | 用户自己的密码 | 部分root环境   | `/root` | 类似于`su -`，但是密码和环境有区别 |

## DNS 配置

### /etc/resolv.conf 文件说明

`/etc/resolv.conf` 是 Linux 系统中用于配置 DNS 解析器的配置文件。它定义了系统在进行域名解析时使用的 DNS 服务器地址。

#### nameserver 的作用

- **定义 DNS 服务器**：`nameserver` 指令指定了系统用于域名解析的 DNS 服务器 IP 地址
- **解析顺序**：系统会按照配置文件中 `nameserver` 出现的顺序依次尝试查询，如果第一个服务器无响应，会自动尝试下一个
- **查询优先级**：通常配置多个 nameserver 作为备用，提高 DNS 解析的可靠性
- **适用场景**: 多数情况下，如果已经是国内的包源但访问仍然慢，就需要先检查是不是nameserver被污染了

#### 配置文件格式

```bash
# 主 DNS 服务器
nameserver 8.8.8.8

# 备用 DNS 服务器
nameserver 8.8.4.4
```

#### 注意事项

- 在 Ubuntu 18.04+ 版本中，`/etc/resolv.conf` 通常由 `systemd-resolved` 或 `NetworkManager` 自动管理
- 手动修改可能会被系统自动覆盖
- 如需永久修改，建议通过 `netplan` 或 `NetworkManager` 配置

### 国内常用 nameserver

#### 公共 DNS 服务商

| DNS 服务商 | 主 DNS | 备用 DNS | 特点 |
|---------|--------|---------|------|
| **阿里云 DNS** | `223.5.5.5` | `223.6.6.6` | 国内访问速度快，稳定性好 |
| **腾讯云 DNS** | `119.29.29.29` | `182.254.116.116` | 腾讯云提供，响应速度快 |
| **114 DNS** | `114.114.114.114` | `114.114.115.115` | 老牌公共 DNS，兼容性好 |
| **百度 DNS** | `180.76.76.76` | - | 百度提供，国内访问优化 |
| **CNNIC DNS** | `1.2.4.8` | `210.2.4.8` | 中国互联网络信息中心提供 |

#### 国际 DNS 服务商（国内可用性有限）

| DNS 服务商 | 主 DNS | 备用 DNS | 特点 |
|---------|--------|---------|------|
| **Google DNS** | `8.8.8.8` | `8.8.4.4` | 全球知名，国内可能被限制 |
| **Cloudflare DNS** | `1.1.1.1` | `1.0.0.1` | 速度快，隐私保护，国内可用性不稳定 |
| **OpenDNS** | `208.67.222.222` | `208.67.220.220` | 思科提供，国内可用性有限 |

#### 推荐配置（国内使用）

```bash
# 编辑 /etc/resolv.conf（临时修改）
sudo nano /etc/resolv.conf

# 推荐配置（阿里云 + 腾讯云）
nameserver 223.5.5.5
nameserver 119.29.29.29
nameserver 223.6.6.6
```

#### 通过 netplan 永久配置（Ubuntu 18.04+）

```yaml
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: true
      nameservers:
        addresses:
          - 223.5.5.5
          - 119.29.29.29
          - 223.6.6.6
```

配置完成后执行：
```bash
sudo netplan apply
```

#### 验证 DNS 配置

```bash
# 查看当前 DNS 配置
cat /etc/resolv.conf

# 测试 DNS 解析
nslookup baidu.com
dig baidu.com

# 查看 DNS 解析时间
time nslookup baidu.com
```

#### 临时禁用DNS缓存
```bash
sudo systemctl restart systemd-resolved（或sudo /etc/init.d/nscd restart）
```


## Ubuntu 软件仓库
在 Ubuntu 24.04 之前，Ubuntu 的软件源配置文件使用传统的 One-Line-Style，路径为 /etc/apt/sources.list；从 Ubuntu 24.04 开始，Ubuntu 的软件源配置文件变更为 DEB822 格式，路径为 /etc/apt/sources.list.d/ubuntu.sources。  
如果使用的是国内aliyun或腾讯云的服务器一般不需要修改，内置了自家的包源

### (清华大学包源)[https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/]
传统格式-ubuntu 24.04 LTS（`/etc/apt/sources.list`）
```conf
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
deb http://security.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse
# deb-src http://security.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
```

DEB822 格式-ubuntu 24.04 LTS（`/etc/apt/sources.list.d/ubuntu.sources`）
```conf
Types: deb
URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
# Types: deb-src
# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# Suites: noble noble-updates noble-backports
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
Types: deb
URIs: http://security.ubuntu.com/ubuntu/
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# Types: deb-src
# URIs: http://security.ubuntu.com/ubuntu/
# Suites: noble-security
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 预发布软件源，不建议启用

# Types: deb
# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# Suites: noble-proposed
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# # Types: deb-src
# # URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# # Suites: noble-proposed
# # Components: main restricted universe multiverse
# # Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
```

