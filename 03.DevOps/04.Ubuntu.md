---
title: Ubuntu常用命令
date: 2025-12-15
author: Eugen
tags:
  - Ubuntu
  - Linux
  - 系统管理
  - 权限管理
  - sudo
  - su
  - DNS
  - 网络配置
---

## 常用命令

### 切换账号

| 命令             | 需要密码    | 环境变化       | 切换到目录   | 常用场景                 |
| -------------- | ------- | ---------- | ------- | -------------------- |
| `su -`         | root 密码 | 完整 root 环境 | `/root` | 需要完全 root 环境工作       |
| `su root`      | root 密码 | 原用户环境      | 当前目录    | 临时执行 root 命令         |
| `sudo -i`      | 用户自己的密码 | 完整 root 环境 | `/root` | Ubuntu 推荐方式          |
| `sudo -s`      | 用户自己的密码 | 混合环境       | 当前目录    | 保留部分环境               |
| `sudo command` | 用户自己的密码 | 不切换用户      | 不切换目录   | 单条命令提权               |
| `sudo su`      | 用户自己的密码 | 部分root环境   | `/root` | 类似于`su -`，但是密码和环境有区别 |

## DNS 配置

### /etc/resolv.conf 文件说明

`/etc/resolv.conf` 是 Linux 系统中用于配置 DNS 解析器的配置文件。它定义了系统在进行域名解析时使用的 DNS 服务器地址,该文件由系统自动管理，重启或网络变动后会被覆盖。所以只能临时生效。

### nameserver 的作用

- **定义 DNS 服务器**：`nameserver` 指令指定了系统用于域名解析的 DNS 服务器 IP 地址
- **解析顺序**：系统会按照配置文件中 `nameserver` 出现的顺序依次尝试查询，如果第一个服务器无响应，会自动尝试下一个
- **查询优先级**：通常配置多个 nameserver 作为备用，提高 DNS 解析的可靠性
- **适用场景**: 多数情况下，如果已经是国内的包源但访问仍然慢，就需要先检查是不是nameserver被污染了

### 1. 核心原理
1.  **不要修改 `/etc/resolv.conf`**：该文件由系统自动管理，重启或网络变动后会被覆盖。
2.  **不要修改 `50-cloud-init.yaml`**：该文件由云服务商（如阿里云/AWS）管理，实例重启后会被还原。
3.  **正确做法**：创建一个独立的 Netplan 配置文件（如 `99-custom-dns.yaml`），Netplan 会自动将其与系统默认配置合并。

---

### 2. 配置步骤

#### 第一步：确认网卡名称
首先确认你的网卡名称（通常为 `eth0`，也有可能是 `ens33` 等）。
```bash
ip addr
```

#### 第二步：创建自定义配置文件
创建一个优先级较高的配置文件，确保它能覆盖默认设置。

```bash
sudo nano /etc/netplan/99-custom-dns.yaml
```

#### 第三步：写入配置（关键步骤）
将以下内容复制到文件中。
**注意**：
*   请确保缩进（2个空格）严格对齐。
*   `eth0` 需替换为你实际的网卡名称。
*   `dhcp4-overrides` 用于忽略云厂商通过 DHCP 强制下发的内网 DNS。

```yaml
network:
  version: 2
  ethernets:
    eth0:
      # 忽略 DHCP 下发的 DNS，强制使用自定义 DNS
      dhcp4-overrides:
        use-dns: false
      nameservers:
        addresses:
          - 8.8.8.8      # Google DNS
          - 223.5.5.5    # 阿里 DNS
```

保存并退出编辑器（在 Nano 中按 `Ctrl+O` 回车保存，然后 `Ctrl+X` 退出）。

#### 第四步：应用更改
执行以下命令让配置生效（如果没有报错即表示语法正确）：

```bash
sudo netplan apply
```

---

### 3. 验证生效

#### ⚠️ 重要提示：关于 /etc/resolv.conf
执行完上述操作后，**不要** 通过查看 `/etc/resolv.conf` 来验证。
在 Ubuntu 中，该文件通常只显示：
`nameserver 127.0.0.53`
这是指向本地 DNS 存根服务（systemd-resolved），属于正常现象，**不代表配置未生效**。

#### ✅ 正确验证方法
请使用以下命令查看底层 DNS 绑定状态：

```bash
resolvectl status
# 或者在旧版本系统中使用： systemd-resolve --status
```

**预期结果**：
在输出信息中找到你的网卡部分（如 `Link 2 (eth0)`），其 `DNS Servers` 字段应仅显示你配置的 IP：
```text
Link 2 (eth0)
      Current Scopes: DNS
DefaultRoute setting: yes
       LLMNR setting: yes
XXX MulticastDNS setting: no
  DNSOverTLS setting: no
      DNSSEC setting: no
    DNSSEC supported: no
         DNS Servers: 8.8.8.8
                      223.5.5.5
```
如果看到上述结果，说明 DNS 修改已成功且永久生效。

### 国内常用 nameserver

#### 公共 DNS 服务商

| DNS 服务商 | 主 DNS | 备用 DNS | 特点 |
|---------|--------|---------|------|
| **阿里云 DNS** | `223.5.5.5` | `223.6.6.6` | 国内访问速度快，稳定性好 |
| **腾讯云 DNS** | `119.29.29.29` | `182.254.116.116` | 腾讯云提供，响应速度快 |
| **114 DNS** | `114.114.114.114` | `114.114.115.115` | 老牌公共 DNS，兼容性好 |
| **百度 DNS** | `180.76.76.76` | - | 百度提供，国内访问优化 |
| **CNNIC DNS** | `1.2.4.8` | `210.2.4.8` | 中国互联网络信息中心提供 |

#### 国际 DNS 服务商（国内可用性有限）

| DNS 服务商 | 主 DNS | 备用 DNS | 特点 |
|---------|--------|---------|------|
| **Google DNS** | `8.8.8.8` | `8.8.4.4` | 全球知名，国内可能被限制 |
| **Cloudflare DNS** | `1.1.1.1` | `1.0.0.1` | 速度快，隐私保护，国内可用性不稳定 |
| **OpenDNS** | `208.67.222.222` | `208.67.220.220` | 思科提供，国内可用性有限 |





## Ubuntu 软件仓库
在 Ubuntu 24.04 之前，Ubuntu 的软件源配置文件使用传统的 One-Line-Style，路径为 /etc/apt/sources.list；从 Ubuntu 24.04 开始，Ubuntu 的软件源配置文件变更为 DEB822 格式，路径为 /etc/apt/sources.list.d/ubuntu.sources。  
如果使用的是国内aliyun或腾讯云的服务器一般不需要修改，内置了自家的包源

### (清华大学包源)[https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/]
传统格式-ubuntu 24.04 LTS（`/etc/apt/sources.list`）
```conf
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
deb http://security.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse
# deb-src http://security.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
```

DEB822 格式-ubuntu 24.04 LTS（`/etc/apt/sources.list.d/ubuntu.sources`）
```conf
Types: deb
URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
Suites: noble noble-updates noble-backports
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
# Types: deb-src
# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# Suites: noble noble-updates noble-backports
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
Types: deb
URIs: http://security.ubuntu.com/ubuntu/
Suites: noble-security
Components: main restricted universe multiverse
Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# Types: deb-src
# URIs: http://security.ubuntu.com/ubuntu/
# Suites: noble-security
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# 预发布软件源，不建议启用

# Types: deb
# URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# Suites: noble-proposed
# Components: main restricted universe multiverse
# Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg

# # Types: deb-src
# # URIs: https://mirrors.tuna.tsinghua.edu.cn/ubuntu
# # Suites: noble-proposed
# # Components: main restricted universe multiverse
# # Signed-By: /usr/share/keyrings/ubuntu-archive-keyring.gpg
```

## GitHub 访问加速

国内网络访问 GitHub 速度过慢的主要原因是其 CDN 域名遭到 DNS 污染，导致无法连接使用 GitHub 的加速服务。以下提供几种 Linux 系统下的解决方案。

### 方案一：修改本地 Hosts 文件

通过修改 `/etc/hosts` 文件，将 GitHub 相关域名指向可访问的 IP 地址，绕过 DNS 污染。

#### 操作步骤

1. **编辑 hosts 文件**（需要 root 权限）：
```bash
sudo vi /etc/hosts
# 或使用其他编辑器
sudo nano /etc/hosts
```

2. **添加 GitHub 域名映射**：
将以下内容添加到文件末尾（hosts 最新代码链接：https://raw.hellogithub.com/hosts，建议定期更新）：

```bash
# GitHub520 Host Start
140.82.113.4                  alive.github.com
140.82.113.4                  live.github.com
35.89.211.130                 github.githubassets.com
140.82.113.4                  central.github.com
35.91.205.163                 desktop.githubusercontent.com
140.82.113.4                  assets-cdn.github.com
54.187.119.73                 camo.githubusercontent.com
151.101.1.6                   github.map.fastly.net
151.101.1.6                   github.global.ssl.fastly.net
140.82.113.4                  gist.github.com
185.199.108.153               github.io
140.82.113.4                  github.com
192.0.66.2                    github.blog
140.82.113.4                  api.github.com
54.187.192.31                 raw.githubusercontent.com
18.237.195.231                user-images.githubusercontent.com
52.25.220.42                  favicons.githubusercontent.com
35.90.114.155                 avatars5.githubusercontent.com
35.91.205.163                 avatars4.githubusercontent.com
54.187.119.73                 avatars3.githubusercontent.com
34.217.211.252                avatars2.githubusercontent.com
54.68.45.78                   avatars1.githubusercontent.com
35.90.114.155                 avatars0.githubusercontent.com
52.25.220.42                  avatars.githubusercontent.com
140.82.113.4                  codeload.github.com
72.21.206.80                  github-cloud.s3.amazonaws.com
72.21.206.80                  github-com.s3.amazonaws.com
72.21.206.80                  github-production-release-asset-2e65be.s3.amazonaws.com
72.21.206.80                  github-production-user-asset-6210df.s3.amazonaws.com
72.21.206.80                  github-production-repository-file-5c1aeb.s3.amazonaws.com
185.199.108.153               githubstatus.com
140.82.114.18                 github.community
52.224.38.193                 github.dev
140.82.113.4                  collector.github.com
54.202.167.66                 pipelines.actions.githubusercontent.com
35.92.254.178                 media.githubusercontent.com
54.214.143.191                cloud.githubusercontent.com
54.214.169.83                 objects.githubusercontent.com
13.107.219.40                 vscode.dev
# GitHub520 Host End
```

3. **刷新 DNS 缓存**：
```bash
# Ubuntu/Debian
sudo systemctl restart systemd-resolved
# 或
sudo /etc/init.d/nscd restart

# 如果上述命令报错，需要先安装 nscd
sudo apt install nscd
sudo /etc/init.d/nscd restart
```

4. **验证配置**：
```bash
# 测试 GitHub 域名解析
nslookup github.com
ping github.com
```

#### 自动更新 hosts（推荐）

可以使用脚本定期更新 hosts 文件，获取最新的 IP 地址：

```bash
# 下载最新 hosts 配置
curl -o /tmp/github-hosts https://raw.hellogithub.com/hosts

# 备份原 hosts 文件
sudo cp /etc/hosts /etc/hosts.backup

# 添加 GitHub hosts（保留原有配置）
sudo bash -c 'cat /tmp/github-hosts >> /etc/hosts'

# 刷新 DNS
sudo systemctl restart systemd-resolved
```
