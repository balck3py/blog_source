---
title: Dockerfile å®Œå…¨æŒ‡å—ï¼ˆå«ä¼˜åŒ–é•œåƒå¤§å°æ€è·¯ï¼‰
date: 2026-01-13
author: Eugen
tags:
  - Docker
  - Dockerfile
  - å®¹å™¨åŒ–
  - é•œåƒä¼˜åŒ–
  - å¤šé˜¶æ®µæ„å»º
---

# ğŸ³ Dockerfile å®Œå…¨æŒ‡å—ï¼ˆå«ä¼˜åŒ–é•œåƒå¤§å°æ€è·¯ï¼‰

> ä»å…¥é—¨åˆ°ç²¾é€šï¼šä¸€ä»½é¢å‘åˆå­¦è€…çš„ Docker é•œåƒä¼˜åŒ–å®æˆ˜æ•™ç¨‹

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šDockerfile åŸºç¡€çŸ¥è¯†

### ğŸ¤” ä»€ä¹ˆæ˜¯ Dockerfile

Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—**æŒ‡ä»¤ï¼ˆInstructionsï¼‰**ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»º Docker é•œåƒã€‚

**ç±»æ¯”ç†è§£**ï¼š
- Dockerfile = é£Ÿè°± ğŸ“–
- Docker é•œåƒ = åšå¥½çš„èœ ğŸœ
- Docker å®¹å™¨ = ç«¯ä¸Šæ¡Œçš„èœ ğŸ½ï¸

```dockerfile
# è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ Dockerfile
FROM ubuntu:20.04          # ä» Ubuntu 20.04 å¼€å§‹
RUN apt-get update         # æ›´æ–°è½¯ä»¶æº
RUN apt-get install -y nginx  # å®‰è£… Nginx
CMD ["nginx", "-g", "daemon off;"]  # å¯åŠ¨ Nginx
```

---

### ğŸ“– æ ¸å¿ƒæŒ‡ä»¤è¯¦è§£

#### 1ï¸âƒ£ **FROM** - æŒ‡å®šåŸºç¡€é•œåƒ

```dockerfile
FROM <é•œåƒå>:<æ ‡ç­¾>
```

**ä½œç”¨**ï¼šæ‰€æœ‰ Dockerfile å¿…é¡»ä»¥ FROM å¼€å§‹ï¼ŒæŒ‡å®šåŸºäºå“ªä¸ªé•œåƒæ„å»ºã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
FROM node:14-alpine        # ä½¿ç”¨ Node.js 14 çš„ Alpine ç‰ˆæœ¬
FROM nginx:latest          # ä½¿ç”¨æœ€æ–°ç‰ˆ Nginx
FROM ubuntu:20.04          # ä½¿ç”¨ Ubuntu 20.04
FROM scratch               # ä»ç©ºç™½é•œåƒå¼€å§‹ï¼ˆæœ€å°åŒ–ï¼‰
```

**å¸¸è§é•œåƒå¯¹æ¯”**ï¼š
| é•œåƒ | å¤§å° | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `ubuntu:20.04` | ~70MB | éœ€è¦å®Œæ•´ Linux ç¯å¢ƒ |
| `alpine:latest` | ~5MB | è¿½æ±‚å°ä½“ç§¯ |
| `node:14` | ~900MB | Node.js å¼€å‘ï¼ˆåŒ…å«æ‰€æœ‰å·¥å…·ï¼‰ |
| `node:14-alpine` | ~110MB | Node.js ç”Ÿäº§ç¯å¢ƒ |
| `scratch` | 0MB | é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ |

---

#### 2ï¸âƒ£ **RUN** - æ‰§è¡Œå‘½ä»¤

```dockerfile
RUN <å‘½ä»¤>
```

**ä½œç”¨**ï¼šåœ¨é•œåƒæ„å»ºè¿‡ç¨‹ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œæ¯ä¸ª RUN æŒ‡ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ã€‚

**ä¸¤ç§å†™æ³•**ï¼š

```dockerfile
# Shell å½¢å¼ï¼ˆæ¨èï¼‰
RUN apt-get update && apt-get install -y nginx

# Exec å½¢å¼
RUN ["apt-get", "update"]
```

**âš ï¸ å¸¸è§é”™è¯¯**ï¼š
```dockerfile
# âŒ é”™è¯¯ï¼šæ¯ä¸ª RUN åˆ›å»ºä¸€ä¸ªå±‚
RUN apt-get update
RUN apt-get install -y nginx
RUN apt-get install -y curl
RUN apt-get clean

# âœ… æ­£ç¡®ï¼šåˆå¹¶ä¸ºä¸€ä¸ªå±‚
RUN apt-get update && \
    apt-get install -y nginx curl && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
```

---

#### 3ï¸âƒ£ **CMD** vs **ENTRYPOINT** - å®¹å™¨å¯åŠ¨å‘½ä»¤

##### **CMD** - é»˜è®¤å‘½ä»¤

```dockerfile
CMD ["executable", "param1", "param2"]
```

**ç‰¹ç‚¹**ï¼š
- å¯ä»¥è¢« `docker run` å‘½ä»¤è¡Œå‚æ•°è¦†ç›–
- ä¸€ä¸ª Dockerfile åªèƒ½æœ‰ä¸€ä¸ª CMDï¼ˆå¤šä¸ªåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼‰

**ç¤ºä¾‹**ï¼š
```dockerfile
FROM ubuntu:20.04
CMD ["echo", "Hello World"]

# è¿è¡Œå®¹å™¨
docker run myimage              # è¾“å‡º: Hello World
docker run myimage echo "Hi"    # è¾“å‡º: Hiï¼ˆè¦†ç›–äº† CMDï¼‰
```

##### **ENTRYPOINT** - å…¥å£ç‚¹

```dockerfile
ENTRYPOINT ["executable", "param1"]
```

**ç‰¹ç‚¹**ï¼š
- ä¸ä¼šè¢« `docker run` å‚æ•°è¦†ç›–ï¼ˆé™¤éä½¿ç”¨ `--entrypoint`ï¼‰
- é€šå¸¸ä¸ CMD é…åˆä½¿ç”¨

**ç¤ºä¾‹**ï¼š
```dockerfile
FROM ubuntu:20.04
ENTRYPOINT ["echo"]
CMD ["Hello World"]

# è¿è¡Œå®¹å™¨
docker run myimage              # è¾“å‡º: Hello World
docker run myimage "Hi"         # è¾“å‡º: Hiï¼ˆCMD è¢«æ›¿æ¢ï¼‰
docker run --entrypoint ls myimage  # æ‰§è¡Œ ls å‘½ä»¤
```

##### **CMD vs ENTRYPOINT å¯¹æ¯”**

```dockerfile
# åœºæ™¯ 1ï¼šçº¯ CMD
CMD ["python", "app.py"]
# docker run myimage            â†’ python app.py
# docker run myimage python test.py â†’ python test.py

# åœºæ™¯ 2ï¼šçº¯ ENTRYPOINT
ENTRYPOINT ["python", "app.py"]
# docker run myimage            â†’ python app.py
# docker run myimage --debug    â†’ python app.py --debug

# åœºæ™¯ 3ï¼šç»„åˆä½¿ç”¨ï¼ˆæ¨èï¼‰
ENTRYPOINT ["python"]
CMD ["app.py"]
# docker run myimage            â†’ python app.py
# docker run myimage test.py    â†’ python test.py
```

---

#### 4ï¸âƒ£ **COPY** vs **ADD** - å¤åˆ¶æ–‡ä»¶

##### **COPY** - ç®€å•å¤åˆ¶

```dockerfile
COPY <æºè·¯å¾„> <ç›®æ ‡è·¯å¾„>
```

**ç¤ºä¾‹**ï¼š
```dockerfile
COPY app.py /app/
COPY . /app/
COPY --from=builder /app/dist /dist
```

##### **ADD** - å¢å¼ºå¤åˆ¶

```dockerfile
ADD <æºè·¯å¾„> <ç›®æ ‡è·¯å¾„>
```

**é¢å¤–åŠŸèƒ½**ï¼š
- è‡ªåŠ¨è§£å‹ tar å‹ç¼©åŒ…
- æ”¯æŒ URL ä¸‹è½½

**ç¤ºä¾‹**ï¼š
```dockerfile
ADD app.tar.gz /app/           # è‡ªåŠ¨è§£å‹
ADD https://example.com/file.zip /tmp/  # ä¸‹è½½æ–‡ä»¶
```

##### **COPY vs ADD å¯¹æ¯”**

| åŠŸèƒ½ | COPY | ADD |
|------|------|-----|
| å¤åˆ¶æœ¬åœ°æ–‡ä»¶ | âœ… | âœ… |
| ä»å…¶ä»–é˜¶æ®µå¤åˆ¶ | âœ… | âŒ |
| è‡ªåŠ¨è§£å‹ tar | âŒ | âœ… |
| ä¸‹è½½ URL | âŒ | âœ… |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­ |

**ğŸ’¡ æœ€ä½³å®è·µ**ï¼šä¼˜å…ˆä½¿ç”¨ COPYï¼Œåªåœ¨éœ€è¦è§£å‹æ—¶ç”¨ ADDã€‚

---

#### 5ï¸âƒ£ **WORKDIR** - è®¾ç½®å·¥ä½œç›®å½•

```dockerfile
WORKDIR /path/to/directory
```

**ä½œç”¨**ï¼šè®¾ç½®åç»­æŒ‡ä»¤çš„å·¥ä½œç›®å½•ï¼Œç±»ä¼¼ `cd` å‘½ä»¤ã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
# âŒ ä¸æ¨è
RUN cd /app && npm install

# âœ… æ¨è
WORKDIR /app
RUN npm install
```

---

#### 6ï¸âƒ£ **ENV** - è®¾ç½®ç¯å¢ƒå˜é‡

```dockerfile
ENV <key>=<value>
```

**ç¤ºä¾‹**ï¼š
```dockerfile
ENV NODE_ENV=production
ENV PATH=/app/bin:$PATH
ENV PORT=8080 \
    DEBUG=false
```

**ä½¿ç”¨åœºæ™¯**ï¼š
```dockerfile
ENV APP_HOME=/app
WORKDIR $APP_HOME
COPY . $APP_HOME
```

---

#### 7ï¸âƒ£ **EXPOSE** - å£°æ˜ç«¯å£

```dockerfile
EXPOSE <ç«¯å£å·>
```

**ä½œç”¨**ï¼šå£°æ˜å®¹å™¨ç›‘å¬çš„ç«¯å£ï¼ˆä»…æ–‡æ¡£ä½œç”¨ï¼Œä¸ä¼šå®é™…å¼€æ”¾ç«¯å£ï¼‰ã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
EXPOSE 8080
EXPOSE 80 443
```

**âš ï¸ æ³¨æ„**ï¼šå®é™…ç«¯å£æ˜ å°„éœ€è¦åœ¨è¿è¡Œæ—¶æŒ‡å®šï¼š
```bash
docker run -p 8080:8080 myimage
```

---

#### 8ï¸âƒ£ **VOLUME** - æŒ‚è½½å·

```dockerfile
VOLUME ["/data"]
```

**ä½œç”¨**ï¼šåˆ›å»ºæŒ‚è½½ç‚¹ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®ã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
VOLUME /var/log
VOLUME ["/data", "/config"]
```

---

#### 9ï¸âƒ£ **ARG** - æ„å»ºå‚æ•°

```dockerfile
ARG <name>[=<default value>]
```

**ä½œç”¨**ï¼šå®šä¹‰æ„å»ºæ—¶çš„å˜é‡ï¼ˆä¸ä¼šä¿ç•™åˆ°é•œåƒä¸­ï¼‰ã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
ARG VERSION=1.0
RUN echo "Building version $VERSION"

# æ„å»ºæ—¶ä¼ å‚
docker build --build-arg VERSION=2.0 .
```

##### **ARG vs ENV å¯¹æ¯”**

| ç‰¹æ€§ | ARG | ENV |
|------|-----|-----|
| ä½œç”¨æ—¶é—´ | ä»…æ„å»ºæ—¶ | æ„å»ºæ—¶ + è¿è¡Œæ—¶ |
| æ˜¯å¦ä¿ç•™åˆ°é•œåƒ | âŒ | âœ… |
| å¯å¦åœ¨è¿è¡Œæ—¶ä¿®æ”¹ | âŒ | âœ… |
| é€‚ç”¨åœºæ™¯ | æ„å»ºç‰ˆæœ¬å·ã€URL | åº”ç”¨é…ç½® |

---

#### ğŸ”Ÿ **USER** - è®¾ç½®ç”¨æˆ·

```dockerfile
USER <ç”¨æˆ·åæˆ– UID>
```

**ä½œç”¨**ï¼šæŒ‡å®šåç»­æŒ‡ä»¤ä»¥å“ªä¸ªç”¨æˆ·èº«ä»½æ‰§è¡Œã€‚

**ç¤ºä¾‹**ï¼š
```dockerfile
# åˆ›å»ºé root ç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰
RUN adduser -D appuser
USER appuser
CMD ["node", "app.js"]
```

---

### ğŸ“ åŸºç¡€æ ¼å¼è§„èŒƒ

#### 1. **æ³¨é‡Š**
```dockerfile
# è¿™æ˜¯å•è¡Œæ³¨é‡Š
FROM ubuntu:20.04  # è¡Œå°¾æ³¨é‡Š
```

#### 2. **æ¢è¡Œ**
```dockerfile
# ä½¿ç”¨åæ–œæ  \ æ¢è¡Œ
RUN apt-get update && \
    apt-get install -y \
        nginx \
        curl \
        vim
```

#### 3. **æŒ‡ä»¤é¡ºåº**
```dockerfile
# âœ… æ¨èé¡ºåº
FROM <åŸºç¡€é•œåƒ>
LABEL <å…ƒæ•°æ®>
ENV <ç¯å¢ƒå˜é‡>
ARG <æ„å»ºå‚æ•°>
WORKDIR <å·¥ä½œç›®å½•>
COPY <æ–‡ä»¶å¤åˆ¶>
RUN <å®‰è£…ä¾èµ–>
EXPOSE <ç«¯å£>
USER <ç”¨æˆ·>
CMD/ENTRYPOINT <å¯åŠ¨å‘½ä»¤>
```

#### 4. **.dockerignore**
```
# ç±»ä¼¼ .gitignoreï¼Œæ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶
node_modules
.git
*.log
.env
.DS_Store
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹ - KityMinder è„‘å›¾åº”ç”¨

### ğŸ“ é¡¹ç›®èƒŒæ™¯

**KityMinder** æ˜¯ç™¾åº¦ FEX å›¢é˜Ÿå¼€å‘çš„åœ¨çº¿è„‘å›¾ç¼–è¾‘å·¥å…·ï¼ŒåŸºäº SVG æŠ€æœ¯å®ç°ã€‚

**æŠ€æœ¯æ ˆ**ï¼š
- å‰ç«¯ï¼šHTML + CSS + JavaScript
- æ„å»ºå·¥å…·ï¼šGrunt
- ä¾èµ–ç®¡ç†ï¼šnpm + bower
- é¡¹ç›®åœ°å€ï¼šhttps://github.com/fex-team/kityminder

**æ„å»ºæµç¨‹**ï¼š
```bash
git clone https://github.com/fex-team/kityminder.git
git submodule init && git submodule update
npm install && bower install
grunt                  # æ„å»ºç”Ÿæˆ dist ç›®å½•
cd dist && http-server # å¯åŠ¨æœåŠ¡
```

**ç›®æ ‡**ï¼šå°†è¿™ä¸ªé¡¹ç›®å®¹å™¨åŒ–ï¼Œå¹¶ä¸æ–­ä¼˜åŒ–é•œåƒå¤§å°ã€‚

---

### ğŸš€ ç¬¬ä¸€ç‰ˆï¼šæœ€ç®€å•çš„å¯è¿è¡Œç‰ˆæœ¬

#### æ€è·¯åˆ†æ

ä½œä¸ºåˆå­¦è€…ï¼Œæˆ‘ä»¬çš„ç¬¬ä¸€ç›®æ ‡æ˜¯**è®©å®ƒè·‘èµ·æ¥**ï¼

**éœ€æ±‚æ¸…å•**ï¼š
1. âœ… Node.js ç¯å¢ƒï¼ˆè¿è¡Œ npmã€bowerï¼‰
2. âœ… Gitï¼ˆå…‹éš†ä»£ç å’Œå­æ¨¡å—ï¼‰
3. âœ… æ„å»ºå·¥å…·ï¼ˆbowerã€grunt-cliï¼‰
4. âœ… HTTP æœåŠ¡å™¨ï¼ˆæä¾›é™æ€æ–‡ä»¶ï¼‰

#### ä»£ç å®ç°

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Node.js é•œåƒä½œä¸ºåŸºç¡€é•œåƒ
FROM node:14-alpine

# å®‰è£…å¿…è¦çš„ä¾èµ–å·¥å…·
RUN apk add --no-cache git

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å…¨å±€å®‰è£… bower å’Œ grunt-cli
RUN npm install -g bower grunt-cli --unsafe-perm

# å…‹éš†é¡¹ç›®ä»£ç 
RUN git clone https://github.com/fex-team/kityminder.git .

# åˆå§‹åŒ–å¹¶æ›´æ–°å­æ¨¡å—
RUN git submodule init && git submodule update

# å®‰è£…é¡¹ç›®ä¾èµ–
RUN npm install && bower install --allow-root

# æ„å»ºé¡¹ç›®
RUN grunt

# æš´éœ²ç«¯å£ï¼ˆç”¨äº HTTP æœåŠ¡ï¼‰
EXPOSE 8080

# å®‰è£…ç®€å•çš„ HTTP æœåŠ¡å™¨
RUN npm install -g http-server

# å¯åŠ¨æœåŠ¡
CMD ["http-server", "dist", "-p", "8080"]
```

#### ä½¿ç”¨æ–¹æ³•

```bash
# æ„å»ºé•œåƒ
docker build -t kityminder:v1 .

# è¿è¡Œå®¹å™¨
docker run -p 8080:8080 kityminder:v1

# è®¿é—®åº”ç”¨
# æµè§ˆå™¨æ‰“å¼€ http://localhost:8080
```

#### ğŸ“Š æ€§èƒ½åˆ†æ

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| **é•œåƒå¤§å°** | ~1.2 GB ğŸ˜± |
| **æ„å»ºæ—¶é—´** | ~5-10 åˆ†é’Ÿ |
| **RUN æŒ‡ä»¤æ•°é‡** | 7 ä¸ª |
| **é•œåƒå±‚æ•°** | ~15 å±‚ |

#### âš ï¸ å­˜åœ¨çš„é—®é¢˜

1. **é•œåƒå¤ªå¤§**ï¼š1.2GB å¯¹äºä¸€ä¸ªé™æ€ç½‘ç«™æ¥è¯´å¤ªè‡ƒè‚¿
2. **å±‚æ•°å¤ªå¤š**ï¼šæ¯ä¸ª RUN æŒ‡ä»¤åˆ›å»ºä¸€ä¸ªå±‚ï¼Œå¢åŠ å¼€é”€
3. **åŒ…å«æ— ç”¨æ–‡ä»¶**ï¼šæºä»£ç ã€Git å†å²ã€æ„å»ºå·¥å…·éƒ½åœ¨é•œåƒé‡Œ
4. **ç¼“å­˜æœªæ¸…ç†**ï¼šnpmã€bower ç¼“å­˜å ç”¨å¤§é‡ç©ºé—´

**ä¸‹ä¸€æ­¥**ï¼šå¼€å§‹ä¼˜åŒ–ï¼

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ¸è¿›å¼ä¼˜åŒ–ä¹‹æ—…

### ğŸ¯ ç¬¬äºŒç‰ˆï¼šåˆå¹¶å‘½ä»¤å‡å°‘å±‚æ•°

#### ğŸ’¡ ä¼˜åŒ–æ€è·¯

**æ ¸å¿ƒé—®é¢˜**ï¼šDocker é•œåƒæ˜¯åˆ†å±‚çš„ï¼Œæ¯ä¸ª RUN æŒ‡ä»¤åˆ›å»ºä¸€ä¸ªæ–°å±‚ã€‚

**ç±»æ¯”ç†è§£**ï¼š
- æƒ³è±¡é•œåƒæ˜¯ä¸€ä¸ªåƒå±‚è›‹ç³• ğŸ‚
- æ¯ä¸ª RUN æŒ‡ä»¤æ˜¯ä¸€å±‚
- å³ä½¿åé¢åˆ é™¤æ–‡ä»¶ï¼Œé‚£å±‚è›‹ç³•è¿˜åœ¨ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼šåˆå¹¶ RUN æŒ‡ä»¤ï¼Œåœ¨åŒä¸€å±‚ä¸­å®Œæˆå®‰è£…å’Œæ¸…ç†ã€‚

#### ğŸ” Docker é•œåƒå±‚çš„ç§˜å¯†

```dockerfile
# ç¤ºä¾‹ï¼šåˆ é™¤æ–‡ä»¶çš„é™·é˜±
RUN wget https://example.com/bigfile.tar.gz  # Layer 1: +500MB
RUN tar -xzf bigfile.tar.gz                   # Layer 2: +200MB
RUN rm bigfile.tar.gz                         # Layer 3: åªæ˜¯æ ‡è®°åˆ é™¤

# æœ€ç»ˆé•œåƒå¤§å° = Layer 1 + Layer 2 + Layer 3 = 700MB
# bigfile.tar.gz ä»ç„¶å­˜åœ¨äº Layer 1ï¼
```

**æ­£ç¡®åšæ³•**ï¼š
```dockerfile
RUN wget https://example.com/bigfile.tar.gz && \
    tar -xzf bigfile.tar.gz && \
    rm bigfile.tar.gz  # åœ¨åŒä¸€å±‚åˆ é™¤

# æœ€ç»ˆé•œåƒå¤§å° = 200MBï¼ˆåªæœ‰è§£å‹åçš„æ–‡ä»¶ï¼‰
```

#### ä»£ç å®ç°

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Node.js é•œåƒä½œä¸ºåŸºç¡€é•œåƒ
FROM node:14-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼šåˆå¹¶æ‰€æœ‰æ„å»ºæ­¥éª¤åˆ°ä¸€ä¸ª RUN æŒ‡ä»¤
RUN apk add --no-cache git && \
    npm install -g bower grunt-cli http-server --unsafe-perm && \
    git clone https://github.com/fex-team/kityminder.git . && \
    git submodule init && \
    git submodule update && \
    npm install && \
    bower install --allow-root && \
    grunt && \
    # æ¸…ç†æ„å»ºç¼“å­˜å’Œä¸å¿…è¦çš„æ–‡ä»¶
    npm cache clean --force && \
    bower cache clean && \
    rm -rf /root/.npm /root/.bower /tmp/* && \
    # åˆ é™¤æºä»£ç å’Œä¾èµ–ï¼Œåªä¿ç•™æ„å»ºåçš„ dist ç›®å½•
    find . -mindepth 1 -maxdepth 1 ! -name 'dist' -exec rm -rf {} + && \
    # å¸è½½æ„å»ºå·¥å…·ï¼ˆè¿è¡Œæ—¶ä¸éœ€è¦ï¼‰
    npm uninstall -g bower grunt-cli && \
    apk del git

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨æœåŠ¡
CMD ["http-server", "dist", "-p", "8080"]
```

#### ğŸ“ ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

##### 1. **åˆå¹¶å‘½ä»¤**
```dockerfile
# ä½¿ç”¨ && è¿æ¥å‘½ä»¤ï¼Œå¤±è´¥æ—¶ç«‹å³åœæ­¢
RUN command1 && \
    command2 && \
    command3
```

##### 2. **æ¸…ç†ç¼“å­˜**
```dockerfile
# npm ç¼“å­˜
npm cache clean --force
rm -rf /root/.npm

# bower ç¼“å­˜
bower cache clean
rm -rf /root/.bower

# ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶
rm -rf /tmp/*
```

##### 3. **åˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶**
```dockerfile
# åªä¿ç•™ dist ç›®å½•
find . -mindepth 1 -maxdepth 1 ! -name 'dist' -exec rm -rf {} +

# ç­‰ä»·äºï¼š
# rm -rf node_modules src lib .git package.json ...
# ï¼ˆä½†æ›´ç®€æ´ï¼‰
```

##### 4. **å¸è½½æ„å»ºå·¥å…·**
```dockerfile
# è¿è¡Œæ—¶ä¸éœ€è¦ bower å’Œ grunt
npm uninstall -g bower grunt-cli

# ä¸éœ€è¦ git
apk del git
```

#### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ç¬¬ä¸€ç‰ˆ | ç¬¬äºŒç‰ˆ | æ”¹è¿› |
|------|--------|--------|------|
| **é•œåƒå¤§å°** | 1200 MB | 400 MB | â¬‡ï¸ 67% |
| **RUN æŒ‡ä»¤æ•°é‡** | 7 ä¸ª | 1 ä¸ª | â¬‡ï¸ 86% |
| **é•œåƒå±‚æ•°** | ~15 å±‚ | ~8 å±‚ | â¬‡ï¸ 47% |
| **æ„å»ºæ—¶é—´** | 10 åˆ†é’Ÿ | 8 åˆ†é’Ÿ | â¬‡ï¸ 20% |

#### âœ… ä¼˜ç‚¹

- âœ… é•œåƒå¤§å°å‡å°‘ 67%
- âœ… å±‚æ•°å‡å°‘ï¼Œä¸‹è½½æ›´å¿«
- âœ… æ— ç”¨æ–‡ä»¶è¢«æ¸…ç†

#### âŒ ç¼ºç‚¹

- âŒ RUN å‘½ä»¤å¾ˆé•¿ï¼Œä¸æ˜“é˜…è¯»
- âŒ æ„å»ºå·¥å…·ã€æºä»£ç è™½ç„¶è¢«åˆ é™¤ï¼Œä½†ä»åœ¨é•œåƒå±‚ä¸­å ç”¨ç©ºé—´
- âŒ ä»ç„¶åŒ…å« Node.js è¿è¡Œæ—¶ï¼ˆå…¶å®ä¸éœ€è¦ï¼‰

**é—®é¢˜çš„æœ¬è´¨**ï¼šå³ä½¿æˆ‘ä»¬åˆ é™¤äº†æ–‡ä»¶ï¼Œå®ƒä»¬ä»ç„¶å­˜åœ¨äºé•œåƒçš„æŸä¸€å±‚ä¸­ï¼

**è§£å†³æ–¹æ¡ˆ**ï¼šå¤šé˜¶æ®µæ„å»ºï¼

---

### ğŸ—ï¸ ç¬¬ä¸‰ç‰ˆï¼šå¤šé˜¶æ®µæ„å»º

#### ğŸ’¡ æ ¸å¿ƒæ€æƒ³

**å…³é”®è®¤çŸ¥**ï¼šæ„å»ºç¯å¢ƒ â‰  è¿è¡Œç¯å¢ƒ

**ç±»æ¯”ç†è§£**ï¼š
- åšèœéœ€è¦ç‚‰ç¶ã€èœåˆ€ã€ç §æ¿ ğŸ”ªğŸ³
- ä½†ç«¯ä¸Šæ¡Œåªéœ€è¦ç›˜å­å’Œç­·å­ ğŸ½ï¸
- ä¸ä¼šæŠŠå¨æˆ¿çš„å·¥å…·ä¸€èµ·ç«¯ä¸Šæ¡Œï¼

#### ğŸ” å¤šé˜¶æ®µæ„å»ºåŸç†

```dockerfile
# é˜¶æ®µ 1ï¼šæ„å»ºé˜¶æ®µï¼ˆä¸´æ—¶ç¯å¢ƒï¼‰
FROM node:14-alpine AS builder
# å®‰è£…æ‰€æœ‰æ„å»ºå·¥å…·
# æ‰§è¡Œæ„å»º
# ç”Ÿæˆ dist ç›®å½•

# é˜¶æ®µ 2ï¼šè¿è¡Œé˜¶æ®µï¼ˆæœ€ç»ˆé•œåƒï¼‰
FROM nginx:alpine
# åªå¤åˆ¶ dist ç›®å½•
COPY --from=builder /app/dist /usr/share/nginx/html

# ğŸ¯ å…³é”®ï¼šé˜¶æ®µ 1 çš„æ‰€æœ‰å†…å®¹éƒ½ä¸ä¼šè¿›å…¥æœ€ç»ˆé•œåƒï¼
```

**ä¸ºä»€ä¹ˆèƒ½å‡å°ä½“ç§¯ï¼Ÿ**

```
å•é˜¶æ®µæ„å»ºï¼š
â”œâ”€â”€ Layer 1: åŸºç¡€é•œåƒ
â”œâ”€â”€ Layer 2: æ„å»ºå·¥å…· (git, bower, grunt)  â† å ç”¨ç©ºé—´
â”œâ”€â”€ Layer 3: æºä»£ç  + .git                  â† å ç”¨ç©ºé—´
â”œâ”€â”€ Layer 4: node_modules                   â† å ç”¨ç©ºé—´
â”œâ”€â”€ Layer 5: æ„å»ºäº§ç‰© (dist)
â””â”€â”€ Layer 6: åˆ é™¤æ ‡è®°ï¼ˆä½†æ–‡ä»¶ä»åœ¨å‰é¢çš„å±‚ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æœ€ç»ˆé•œåƒ = æ‰€æœ‰å±‚ä¹‹å’Œ = å¾ˆå¤§ï¼

å¤šé˜¶æ®µæ„å»ºï¼š
é˜¶æ®µ 1ï¼ˆæ„å»ºï¼‰ï¼š                  é˜¶æ®µ 2ï¼ˆè¿è¡Œï¼‰ï¼š
â”œâ”€â”€ Layer 1: node:14-alpine      â”œâ”€â”€ Layer 1: nginx:alpine
â”œâ”€â”€ Layer 2: æ„å»ºå·¥å…·            â”œâ”€â”€ Layer 2: å¤åˆ¶ dist/
â”œâ”€â”€ Layer 3: æºä»£ç               â””â”€â”€ å°±è¿™äº›ï¼
â”œâ”€â”€ Layer 4: node_modules
â””â”€â”€ Layer 5: æ„å»ºäº§ç‰©
           â†“
      å®Œå…¨ä¸¢å¼ƒï¼                   æœ€ç»ˆé•œåƒ = åªæœ‰é˜¶æ®µ 2
```

#### ä»£ç å®ç°

```dockerfile
# ============================================
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µï¼ˆBuilder Stageï¼‰
# ============================================
FROM node:14-alpine AS builder

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£…æ„å»ºæ‰€éœ€çš„æ‰€æœ‰å·¥å…·å’Œä¾èµ–
RUN apk add --no-cache git && \
    npm install -g bower grunt-cli --unsafe-perm

# å…‹éš†é¡¹ç›®ä»£ç å¹¶åˆå§‹åŒ–å­æ¨¡å—
RUN git clone https://github.com/fex-team/kityminder.git . && \
    git submodule init && \
    git submodule update

# å®‰è£…é¡¹ç›®ä¾èµ–
RUN npm install && bower install --allow-root

# æ‰§è¡Œæ„å»ºï¼Œç”Ÿæˆ dist ç›®å½•
RUN grunt

# ============================================
# ç¬¬äºŒé˜¶æ®µï¼šè¿è¡Œé˜¶æ®µï¼ˆRuntime Stageï¼‰
# ============================================
FROM node:14-alpine

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# åªå®‰è£…è¿è¡Œæ—¶éœ€è¦çš„ HTTP æœåŠ¡å™¨
RUN npm install -g http-server && \
    npm cache clean --force && \
    rm -rf /root/.npm /tmp/*

# ğŸ”¥ å…³é”®ï¼šä»æ„å»ºé˜¶æ®µå¤åˆ¶æ„å»ºäº§ç‰©ï¼ˆåªå¤åˆ¶ dist ç›®å½•ï¼‰
COPY --from=builder /app/dist ./dist

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨æœåŠ¡
CMD ["http-server", "dist", "-p", "8080"]
```

#### ğŸ“ æŠ€æœ¯è¯¦è§£

##### 1. **å‘½åé˜¶æ®µ**
```dockerfile
FROM node:14-alpine AS builder
#                      â†‘ ç»™è¿™ä¸ªé˜¶æ®µå‘½å
```

##### 2. **ä»å…¶ä»–é˜¶æ®µå¤åˆ¶æ–‡ä»¶**
```dockerfile
COPY --from=builder /app/dist ./dist
#           â†‘ ä» builder é˜¶æ®µå¤åˆ¶
```

##### 3. **å¯ä»¥æœ‰å¤šä¸ªé˜¶æ®µ**
```dockerfile
# é˜¶æ®µ 1ï¼šä¸‹è½½ä¾èµ–
FROM node:14-alpine AS deps
RUN npm install

# é˜¶æ®µ 2ï¼šæ„å»º
FROM node:14-alpine AS builder
COPY --from=deps /app/node_modules ./node_modules
RUN npm run build

# é˜¶æ®µ 3ï¼šè¿è¡Œ
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

##### 4. **åªæ„å»ºç‰¹å®šé˜¶æ®µ**
```bash
# åªæ„å»ºåˆ° builder é˜¶æ®µï¼ˆç”¨äºè°ƒè¯•ï¼‰
docker build --target builder -t debug .
```

#### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ç¬¬äºŒç‰ˆ | ç¬¬ä¸‰ç‰ˆ | æ”¹è¿› |
|------|--------|--------|------|
| **é•œåƒå¤§å°** | 400 MB | 150 MB | â¬‡ï¸ 62% |
| **åŒ…å«æ„å»ºå·¥å…·** | âœ… | âŒ | æ›´å®‰å…¨ |
| **åŒ…å«æºä»£ç ** | âœ… | âŒ | æ›´å®‰å…¨ |
| **åŒ…å« node_modules** | âœ… | âŒ | æ›´ç®€æ´ |
| **æ˜“äºè°ƒè¯•** | â­â­ | â­â­â­â­ | é˜¶æ®µåˆ†ç¦» |

#### âœ… ä¼˜ç‚¹

- âœ… é•œåƒå¤§å°å‡å°‘ 62%ï¼ˆä» 400MB åˆ° 150MBï¼‰
- âœ… æ„å»ºå·¥å…·å®Œå…¨ä¸åœ¨æœ€ç»ˆé•œåƒä¸­
- âœ… æºä»£ç å’Œä¾èµ–å®Œå…¨ä¸åœ¨æœ€ç»ˆé•œåƒä¸­
- âœ… æ›´å®‰å…¨ï¼ˆå‡å°‘æ”»å‡»é¢ï¼‰
- âœ… ä»£ç æ›´æ¸…æ™°ï¼ˆèŒè´£åˆ†ç¦»ï¼‰

#### ğŸ¤” æ˜¯å¦è¿˜èƒ½ä¼˜åŒ–ï¼Ÿ

**è§‚å¯Ÿ**ï¼šè¿è¡Œé˜¶æ®µä»åœ¨ä½¿ç”¨ `node:14-alpine` (110MB)

**é—®é¢˜**ï¼šé™æ€ç½‘ç«™éœ€è¦ Node.js è¿è¡Œæ—¶å—ï¼Ÿ

**ç­”æ¡ˆ**ï¼šä¸éœ€è¦ï¼åªéœ€è¦ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼

**ä¸‹ä¸€æ­¥**ï¼šæ›´æ¢åŸºç¡€é•œåƒï¼

---

### ğŸ”„ ç¬¬å››ç‰ˆï¼šæ›´æ¢åŸºç¡€é•œåƒ

#### ğŸ’¡ æ ¸å¿ƒæ€æƒ³

**å…³é”®è®¤çŸ¥**ï¼šæ„å»ºåçš„ `dist` ç›®å½•åªåŒ…å«é™æ€æ–‡ä»¶ï¼ˆHTML/CSS/JSï¼‰ï¼Œä¸éœ€è¦ Node.jsï¼

**é™æ€ç½‘ç«™çš„éœ€æ±‚**ï¼š
- âŒ ä¸éœ€è¦ï¼šNode.jsã€npmã€æ„å»ºå·¥å…·
- âœ… åªéœ€è¦ï¼šHTTP æœåŠ¡å™¨ï¼ˆNginxã€Caddyã€Apache ç­‰ï¼‰

#### ğŸ” åŸºç¡€é•œåƒå¯¹æ¯”

| é•œåƒ | å¤§å° | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| `node:14-alpine` | ~110MB | åŒ…å« Node.js + npm | Node.js åº”ç”¨ |
| `nginx:alpine` | ~25MB | é«˜æ€§èƒ½ Web æœåŠ¡å™¨ | é™æ€ç½‘ç«™ â­ |
| `caddy:alpine` | ~15MB | ç°ä»£ Web æœåŠ¡å™¨ | ç®€å•é…ç½® |
| `httpd:alpine` | ~55MB | Apache æœåŠ¡å™¨ | ä¼ ç»Ÿé€‰æ‹© |
| `busybox` | ~1MB | æœ€å° Linux ç¯å¢ƒ | æè‡´ä¼˜åŒ– |

#### ä»£ç å®ç°ï¼ˆä½¿ç”¨ Nginxï¼‰

```dockerfile
# ============================================
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»ºé˜¶æ®µ
# ============================================
FROM node:14-alpine AS builder

WORKDIR /app

# å®‰è£…æ„å»ºå·¥å…·
RUN apk add --no-cache git && \
    npm install -g bower grunt-cli --unsafe-perm

# å…‹éš†å¹¶æ„å»º
RUN git clone https://github.com/fex-team/kityminder.git . && \
    git submodule init && \
    git submodule update && \
    npm install && \
    bower install --allow-root && \
    grunt

# ============================================
# ç¬¬äºŒé˜¶æ®µï¼šä½¿ç”¨ Nginx æä¾›é™æ€æ–‡ä»¶
# ============================================
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©åˆ° Nginx é»˜è®¤ç›®å½•
COPY --from=builder /app/dist /usr/share/nginx/html

# åˆ›å»ºè‡ªå®šä¹‰ Nginx é…ç½®
RUN echo 'server { \
    listen 8080; \
    location / { \
        root /usr/share/nginx/html; \
        index index.html; \
        try_files $uri $uri/ /index.html; \
    } \
}' > /etc/nginx/conf.d/default.conf

EXPOSE 8080

CMD ["nginx", "-g", "daemon off;"]
```

#### ä»£ç å®ç°ï¼ˆä½¿ç”¨ Caddy - æ›´ç®€å•ï¼‰

```dockerfile
# ============================================
# æ„å»ºé˜¶æ®µ
# ============================================
FROM node:14-alpine AS builder

WORKDIR /app

RUN apk add --no-cache git && \
    npm install -g bower grunt-cli --unsafe-perm && \
    git clone https://github.com/fex-team/kityminder.git . && \
    git submodule init && git submodule update && \
    npm install && bower install --allow-root && grunt

# ============================================
# è¿è¡Œé˜¶æ®µï¼šä½¿ç”¨ Caddyï¼ˆé›¶é…ç½®ï¼ï¼‰
# ============================================
FROM caddy:2-alpine

# å¤åˆ¶é™æ€æ–‡ä»¶
COPY --from=builder /app/dist /srv

EXPOSE 8080

# Caddy è‡ªåŠ¨æä¾›é™æ€æ–‡ä»¶ï¼Œæ— éœ€é…ç½®ï¼
CMD ["caddy", "file-server", "--root", "/srv", "--listen", ":8080"]
```

#### ğŸ“ ä¸ºä»€ä¹ˆ Nginx/Caddy æ›´å¥½ï¼Ÿ

##### **æ€§èƒ½å¯¹æ¯”**

| æŒ‡æ ‡ | http-server (Node.js) | Nginx | Caddy |
|------|----------------------|-------|-------|
| å†…å­˜å ç”¨ | ~50MB | ~5MB | ~10MB |
| å¯åŠ¨æ—¶é—´ | ~2s | ~0.1s | ~0.2s |
| å¹¶å‘å¤„ç† | ~1000 | ~10000 | ~5000 |
| CPU ä½¿ç”¨ | ä¸­ | ä½ | ä½ |

##### **Nginx vs Caddy**

```dockerfile
# Nginxï¼šåŠŸèƒ½å¼ºå¤§ï¼Œéœ€è¦é…ç½®
FROM nginx:alpine
COPY dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf  # éœ€è¦é…ç½®æ–‡ä»¶

# Caddyï¼šè‡ªåŠ¨é…ç½®ï¼Œç®€å•æ˜“ç”¨
FROM caddy:alpine
COPY dist /srv
# å°±è¿™ä¹ˆç®€å•ï¼è‡ªåŠ¨æ”¯æŒ HTTPSã€HTTP/2ã€å‹ç¼©ç­‰
```

#### ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ç¬¬ä¸‰ç‰ˆ (Node.js) | ç¬¬å››ç‰ˆ (Nginx) | æ”¹è¿› |
|------|-----------------|---------------|------|
| **é•œåƒå¤§å°** | 150 MB | 25 MB | â¬‡ï¸ 83% |
| **å†…å­˜å ç”¨** | ~50 MB | ~5 MB | â¬‡ï¸ 90% |
| **å¯åŠ¨æ—¶é—´** | ~2s | ~0.1s | â¬‡ï¸ 95% |
| **å¹¶å‘èƒ½åŠ›** | ä½ | é«˜ | â¬†ï¸ 10x |

#### âœ… ä¼˜ç‚¹

- âœ… é•œåƒå¤§å°ä» 150MB å‡å°‘åˆ° 25MBï¼ˆ83% å‡å°‘ï¼‰
- âœ… æ€§èƒ½å¤§å¹…æå‡ï¼ˆå†…å­˜ã€å¯åŠ¨æ—¶é—´ã€å¹¶å‘ï¼‰
- âœ… æ›´é€‚åˆç”Ÿäº§ç¯å¢ƒ
- âœ… Nginx ä¹…ç»è€ƒéªŒï¼Œç¨³å®šå¯é 

#### ğŸ¤” æ˜¯å¦è¿˜èƒ½ä¼˜åŒ–ï¼Ÿ

å¯ä»¥ï¼ä½†éœ€è¦æƒè¡¡**æ”¶ç›Šå’Œå¤æ‚åº¦**ã€‚

---

### âš¡ ç¬¬äº”ç‰ˆï¼šæè‡´ä¼˜åŒ–

#### ğŸ’¡ ä¼˜åŒ–æ€è·¯æ€»ç»“

ä»¥ä¸‹æ˜¯æ›´å¤šä¼˜åŒ–æŠ€å·§ï¼ŒæŒ‰**æ€§ä»·æ¯”**æ’åºï¼š

#### 1. **æµ…å…‹éš† Git ä»“åº“** â­â­â­â­â­

```dockerfile
# âŒ å…‹éš†å®Œæ•´å†å²ï¼ˆæ…¢ä¸”å¤§ï¼‰
RUN git clone https://github.com/fex-team/kityminder.git .

# âœ… åªå…‹éš†æœ€æ–°æäº¤ï¼ˆå¿«ä¸”å°ï¼‰
RUN git clone --depth 1 https://github.com/fex-team/kityminder.git .

# âœ… å…‹éš†ç‰¹å®šåˆ†æ”¯
RUN git clone --depth 1 --branch v1.4.0 \
    https://github.com/fex-team/kityminder.git .

# âœ…âœ… ç›´æ¥ä¸‹è½½å‹ç¼©åŒ…ï¼ˆæœ€å¿«ï¼‰
RUN wget https://github.com/fex-team/kityminder/archive/v1.4.0.tar.gz && \
    tar -xzf v1.4.0.tar.gz --strip-components=1 && \
    rm v1.4.0.tar.gz
```

**æ•ˆæœ**ï¼šå‡å°‘ 50-80% çš„ä¸‹è½½å¤§å°å’Œæ—¶é—´ã€‚

---

#### 2. **é¢„å‹ç¼©é™æ€èµ„æº** â­â­â­â­

```dockerfile
# æ„å»ºé˜¶æ®µï¼šé¢„å‹ç¼©æ‰€æœ‰é™æ€æ–‡ä»¶
FROM builder AS compressor

WORKDIR /app/dist

# å®‰è£…å‹ç¼©å·¥å…·
RUN apk add --no-cache brotli gzip

# å‹ç¼©æ‰€æœ‰ JSã€CSSã€HTMLã€SVG æ–‡ä»¶
RUN find . -type f \( \
    -name "*.js" -o \
    -name "*.css" -o \
    -name "*.html" -o \
    -name "*.svg" \
    \) -exec sh -c ' \
        gzip -9 -k "$1" && \
        brotli -9 -k "$1" \
    ' _ {} \;

# è¿è¡Œé˜¶æ®µï¼šé…ç½® Nginx ä½¿ç”¨é¢„å‹ç¼©æ–‡ä»¶
FROM nginx:alpine

COPY --from=compressor /app/dist /usr/share/nginx/html

RUN echo 'server { \
    listen 8080; \
    gzip_static on; \
    brotli_static on; \
    location / { \
        root /usr/share/nginx/html; \
        index index.html; \
    } \
}' > /etc/nginx/conf.d/default.conf
```

**æ•ˆæœ**ï¼š
- åŸå§‹æ–‡ä»¶ï¼š100KB
- Gzip å‹ç¼©ï¼š30KB (-70%)
- Brotli å‹ç¼©ï¼š25KB (-75%)

**ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ**
- æµè§ˆå™¨æ”¯æŒæ¥æ”¶å‹ç¼©æ–‡ä»¶
- é¢„å‹ç¼©é¿å…è¿è¡Œæ—¶å‹ç¼©ï¼ŒèŠ‚çœ CPU
- ä¼ è¾“ä½“ç§¯å‡å°‘ï¼ŒåŠ è½½æ›´å¿«

---

#### 3. **åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶** â­â­â­â­

```dockerfile
# åˆ é™¤ source mapsï¼ˆå¼€å‘ç”¨ï¼Œç”Ÿäº§ä¸éœ€è¦ï¼‰
RUN find /app/dist -name "*.map" -delete

# åˆ é™¤æ–‡æ¡£å’Œç¤ºä¾‹
RUN find /app/dist -name "*.md" -delete && \
    find /app/dist -name "test*" -type d -exec rm -rf {} + && \
    find /app/dist -name "example*" -type d -exec rm -rf {} +

# åˆ é™¤æœªå‹ç¼©çš„å›¾ç‰‡ï¼ˆå¦‚æœæœ‰å‹ç¼©ç‰ˆæœ¬ï¼‰
RUN find /app/dist -name "*.png" -exec sh -c ' \
    if [ -f "${1%.png}.webp" ]; then rm "$1"; fi \
' _ {} \;
```

**æ•ˆæœ**ï¼šå¯å‡å°‘ 20-30% çš„ä½“ç§¯ã€‚

---

#### 4. **ä½¿ç”¨ BuildKit ç¼“å­˜æŒ‚è½½** â­â­â­â­

```dockerfile
# syntax=docker/dockerfile:1.4

FROM node:14-alpine AS builder

WORKDIR /app

# ä½¿ç”¨ç¼“å­˜æŒ‚è½½ï¼ˆåŠ é€Ÿé‡å¤æ„å»ºï¼‰
RUN --mount=type=cache,target=/root/.npm \
    --mount=type=cache,target=/root/.bower \
    npm install && bower install --allow-root
```

**å¯ç”¨æ–¹å¼**ï¼š
```bash
# Linux/Mac
DOCKER_BUILDKIT=1 docker build .

# Windows PowerShell
$env:DOCKER_BUILDKIT=1; docker build .
```

**æ•ˆæœ**ï¼š
- é¦–æ¬¡æ„å»ºï¼š10 åˆ†é’Ÿ
- åç»­æ„å»ºï¼š2 åˆ†é’Ÿï¼ˆå¿« 5 å€ï¼‰

---

#### 5. **åˆ†ç¦»ä¾èµ–å®‰è£…ï¼ˆåˆ©ç”¨ç¼“å­˜ï¼‰** â­â­â­â­â­

```dockerfile
# âŒ æ¯æ¬¡ä¿®æ”¹ä»£ç éƒ½è¦é‡æ–°å®‰è£…ä¾èµ–
COPY . /app
RUN npm install

# âœ… å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œå†å®‰è£…ï¼ˆåˆ©ç”¨ Docker ç¼“å­˜ï¼‰
COPY package.json package-lock.json /app/
RUN npm install
COPY . /app/  # ä»£ç å˜æ›´ä¸å½±å“ä¾èµ–å±‚
```

**åŸç†**ï¼š
- Docker æŒ‰å±‚ç¼“å­˜
- å¦‚æœå±‚çš„è¾“å…¥ï¼ˆCOPY çš„æ–‡ä»¶ï¼‰æ²¡å˜ï¼Œä½¿ç”¨ç¼“å­˜
- åªæœ‰ä»£ç å˜åŒ–æ—¶ï¼Œæ‰é‡æ–°æ‰§è¡Œ `COPY . /app/`

---

#### 6. **ä½¿ç”¨ Distroless é•œåƒ** â­â­

```dockerfile
# Google Distrolessï¼šæ— å‘è¡Œç‰ˆåŸºç¡€é•œåƒ
FROM gcr.io/distroless/static-debian11

COPY --from=builder /app/dist /app
COPY --from=builder /usr/bin/caddy /usr/bin/caddy

CMD ["/usr/bin/caddy", "file-server", "--root", "/app"]
```

**ä¼˜åŠ¿**ï¼š
- åªåŒ…å«åº”ç”¨å’Œå¿…è¦çš„åº“
- æ²¡æœ‰ shellã€åŒ…ç®¡ç†å™¨
- é•œåƒå¤§å° ~2-5MB
- æå¤§å‡å°‘æ”»å‡»é¢

**ç¼ºç‚¹**ï¼š
- æ— æ³•ä½¿ç”¨ shell å‘½ä»¤
- è°ƒè¯•å›°éš¾
- éœ€è¦é™æ€ç¼–è¯‘çš„äºŒè¿›åˆ¶

---

#### ğŸ† å®Œæ•´æè‡´ä¼˜åŒ–ç‰ˆ

```dockerfile
# syntax=docker/dockerfile:1.4

# ============================================
# ç¬¬ä¸€é˜¶æ®µï¼šæ„å»º
# ============================================
FROM node:14-alpine AS builder

WORKDIR /app

# å®‰è£…æ„å»ºå·¥å…·
RUN apk add --no-cache git

# å…¨å±€å®‰è£…æ„å»ºå·¥å…·
RUN npm install -g bower grunt-cli --unsafe-perm

# æµ…å…‹éš†é¡¹ç›®ï¼ˆåªä¸‹è½½æœ€æ–°æäº¤ï¼‰
RUN git clone --depth 1 https://github.com/fex-team/kityminder.git .

# åˆå§‹åŒ–å­æ¨¡å—ï¼ˆæµ…å…‹éš†ï¼‰
RUN git submodule update --init --depth 1

# ä½¿ç”¨ç¼“å­˜æŒ‚è½½å®‰è£…ä¾èµ–
RUN --mount=type=cache,target=/root/.npm \
    --mount=type=cache,target=/root/.bower \
    npm install && bower install --allow-root

# æ„å»ºé¡¹ç›®
RUN grunt

# æ¸…ç†ä¸å¿…è¦çš„æ–‡ä»¶
RUN find dist -name "*.map" -delete && \
    find dist -name "*.md" -delete && \
    find dist -type d -name "test*" -exec rm -rf {} + 2>/dev/null || true

# ============================================
# ç¬¬äºŒé˜¶æ®µï¼šå‹ç¼©
# ============================================
FROM builder AS compressor

WORKDIR /app/dist

# å®‰è£…å‹ç¼©å·¥å…·
RUN apk add --no-cache brotli gzip

# é¢„å‹ç¼©é™æ€èµ„æº
RUN find . -type f \( \
        -name "*.js" -o \
        -name "*.css" -o \
        -name "*.html" -o \
        -name "*.svg" \
    \) -exec sh -c 'gzip -9 -k "$1" && brotli -9 -k "$1"' _ {} \;

# ============================================
# ç¬¬ä¸‰é˜¶æ®µï¼šè¿è¡Œï¼ˆNginxï¼‰
# ============================================
FROM nginx:alpine

# å¤åˆ¶å‹ç¼©åçš„æ–‡ä»¶
COPY --from=compressor /app/dist /usr/share/nginx/html

# é…ç½® Nginx æ”¯æŒé¢„å‹ç¼©æ–‡ä»¶
RUN echo 'server { \
    listen 8080; \
    server_tokens off; \
    gzip_static on; \
    location / { \
        root /usr/share/nginx/html; \
        index index.html; \
        try_files $uri $uri/ /index.html; \
        add_header Cache-Control "public, max-age=31536000"; \
    } \
}' > /etc/nginx/conf.d/default.conf && \
    # åˆ é™¤é»˜è®¤é…ç½®
    rm -f /etc/nginx/conf.d/default.conf.default

EXPOSE 8080

CMD ["nginx", "-g", "daemon off;"]
```

#### ğŸ“Š æœ€ç»ˆæ€§èƒ½å¯¹æ¯”

| ç‰ˆæœ¬ | å¤§å° | å†…å­˜ | å¯åŠ¨æ—¶é—´ | å¤æ‚åº¦ |
|------|------|------|---------|--------|
| V1 åŸå§‹ç‰ˆ | 1200 MB | ~50MB | ~2s | â­ |
| V2 åˆå¹¶å‘½ä»¤ | 400 MB | ~50MB | ~2s | â­â­ |
| V3 å¤šé˜¶æ®µ | 150 MB | ~50MB | ~2s | â­â­â­ |
| V4 Nginx | 25 MB | ~5MB | ~0.1s | â­â­â­â­ |
| V5 æè‡´ä¼˜åŒ– | **18 MB** | ~5MB | ~0.1s | â­â­â­â­â­ |

#### ğŸ¯ ä½“ç§¯å‡å°‘å¯è§†åŒ–

```
V1 åŸå§‹ç‰ˆ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 1200 MB (100%)
V2 åˆå¹¶å‘½ä»¤:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š 400 MB (33%)
V3 å¤šé˜¶æ®µ:    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 150 MB (12.5%)
V4 Nginx:     â–ˆ 25 MB (2%)
V5 æè‡´ä¼˜åŒ–:  â–Š 18 MB (1.5%)

æ€»ä¼˜åŒ–ï¼š98.5% ä½“ç§¯å‡å°‘ï¼
```

---

## ç¬¬å››éƒ¨åˆ†ï¼šä¼˜åŒ–æŠ€å·§æ€»ç»“

### ğŸ¯ ä¼˜åŒ–æŠ€å·§é€ŸæŸ¥è¡¨

| æŠ€å·§ | éš¾åº¦ | æ•ˆæœ | æ¨èåº¦ | è¯´æ˜ |
|------|------|------|--------|------|
| **åˆå¹¶ RUN æŒ‡ä»¤** | â­ | â­â­â­ | â­â­â­â­â­ | å‡å°‘å±‚æ•°ï¼Œå¿…å­¦ |
| **å¤šé˜¶æ®µæ„å»º** | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | æœ€é‡è¦çš„ä¼˜åŒ– |
| **é€‰æ‹©å°åŸºç¡€é•œåƒ** | â­ | â­â­â­â­ | â­â­â­â­â­ | alpine > debian > ubuntu |
| **æ¸…ç†ç¼“å­˜** | â­ | â­â­ | â­â­â­â­ | ç®€å•æœ‰æ•ˆ |
| **æµ…å…‹éš† Git** | â­ | â­â­ | â­â­â­â­ | --depth 1 |
| **.dockerignore** | â­ | â­â­ | â­â­â­â­â­ | åŠ é€Ÿæ„å»º |
| **é¢„å‹ç¼©èµ„æº** | â­â­ | â­â­â­ | â­â­â­ | å‡å°‘ä¼ è¾“ |
| **BuildKit ç¼“å­˜** | â­â­ | â­â­â­ | â­â­â­â­ | åŠ é€Ÿé‡å¤æ„å»º |
| **åˆ†ç¦»ä¾èµ–å®‰è£…** | â­â­ | â­â­â­â­ | â­â­â­â­â­ | åˆ©ç”¨ç¼“å­˜ |
| **Distroless** | â­â­â­â­ | â­â­â­â­â­ | â­â­ | æè‡´ä½†å¤æ‚ |

---

### ğŸ“‹ ä¼˜åŒ–æ£€æŸ¥æ¸…å•

#### âœ… åŸºç¡€ä¼˜åŒ–ï¼ˆå¿…åšï¼‰

- [ ] ä½¿ç”¨ Alpine æˆ–å…¶ä»–å°åŸºç¡€é•œåƒ
- [ ] åˆå¹¶ RUN æŒ‡ä»¤
- [ ] æ·»åŠ  .dockerignore æ–‡ä»¶
- [ ] æ¸…ç†åŒ…ç®¡ç†å™¨ç¼“å­˜
- [ ] åˆ é™¤ä¸å¿…è¦çš„æ–‡ä»¶

#### âœ… è¿›é˜¶ä¼˜åŒ–ï¼ˆæ¨èï¼‰

- [ ] ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
- [ ] åˆ†ç¦»ä¾èµ–å®‰è£…å±‚
- [ ] ä½¿ç”¨ä¸“ç”¨è¿è¡Œæ—¶é•œåƒï¼ˆNginx/Caddyï¼‰
- [ ] æµ…å…‹éš† Git ä»“åº“
- [ ] å¯ç”¨ BuildKit

#### âœ… é«˜çº§ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

- [ ] é¢„å‹ç¼©é™æ€èµ„æº
- [ ] ä½¿ç”¨ Distroless é•œåƒ
- [ ] å¤šæ¶æ„æ„å»º
- [ ] å®‰å…¨æ‰«æå’ŒåŠ å›º

---

### ğŸ“ å¸¸è§é”™è¯¯å’Œé™·é˜±

#### âŒ é”™è¯¯ 1ï¼šåœ¨ä¸åŒå±‚åˆ é™¤æ–‡ä»¶

```dockerfile
# âŒ é”™è¯¯ï¼šæ–‡ä»¶ä»åœ¨ Layer 2
RUN wget bigfile.tar.gz       # Layer 1
RUN tar -xzf bigfile.tar.gz   # Layer 2
RUN rm bigfile.tar.gz         # Layer 3ï¼ˆåªæ˜¯æ ‡è®°åˆ é™¤ï¼‰

# âœ… æ­£ç¡®ï¼šåœ¨åŒä¸€å±‚åˆ é™¤
RUN wget bigfile.tar.gz && \
    tar -xzf bigfile.tar.gz && \
    rm bigfile.tar.gz
```

#### âŒ é”™è¯¯ 2ï¼šä¸ä½¿ç”¨ .dockerignore

```dockerfile
# å¦‚æœæ²¡æœ‰ .dockerignore
COPY . /app  # å¤åˆ¶äº† node_modulesã€.gitã€æ—¥å¿—ç­‰æ— ç”¨æ–‡ä»¶

# åˆ›å»º .dockerignore
node_modules
.git
*.log
```

#### âŒ é”™è¯¯ 3ï¼šä¾èµ–å±‚æœªåˆ†ç¦»

```dockerfile
# âŒ æ¯æ¬¡ä»£ç å˜æ›´éƒ½é‡æ–°å®‰è£…ä¾èµ–
COPY . /app
RUN npm install

# âœ… åˆ†ç¦»ä¾èµ–å±‚
COPY package*.json /app/
RUN npm install
COPY . /app/
```

#### âŒ é”™è¯¯ 4ï¼šä½¿ç”¨ latest æ ‡ç­¾

```dockerfile
# âŒ ä¸ç¨³å®šï¿½ï¿½å¯èƒ½å¯¼è‡´æ„å»ºå¤±è´¥
FROM node:latest

# âœ… æŒ‡å®šç‰ˆæœ¬
FROM node:14-alpine
```

#### âŒ é”™è¯¯ 5ï¼šä»¥ root è¿è¡Œåº”ç”¨

```dockerfile
# âŒ å®‰å…¨é£é™©
USER root
CMD ["node", "app.js"]

# âœ… åˆ›å»ºä¸“ç”¨ç”¨æˆ·
RUN adduser -D appuser
USER appuser
CMD ["node", "app.js"]
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šæœ€ä½³å®è·µ

### ğŸ† é€šç”¨æœ€ä½³å®è·µ

#### 1. **é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ**

```dockerfile
# å¼€å‘ç¯å¢ƒï¼šåŠŸèƒ½å®Œæ•´
FROM node:14

# ç”Ÿäº§ç¯å¢ƒï¼šä½“ç§¯ä¼˜åŒ–
FROM node:14-alpine

# é™æ€ç½‘ç«™ï¼šä¸“ç”¨æœåŠ¡å™¨
FROM nginx:alpine

# æè‡´ä¼˜åŒ–ï¼šæœ€å°é•œåƒ
FROM scratch
```

#### 2. **åˆç†ä½¿ç”¨ç¼“å­˜**

```dockerfile
# åˆ©ç”¨ Docker ç¼“å­˜å±‚
# æŠŠå˜åŒ–å°‘çš„æ”¾å‰é¢ï¼Œå˜åŒ–å¤šçš„æ”¾åé¢

# 1. åŸºç¡€ç¯å¢ƒï¼ˆå‡ ä¹ä¸å˜ï¼‰
FROM node:14-alpine
RUN apk add --no-cache git

# 2. ä¾èµ–å®‰è£…ï¼ˆå¶å°”å˜ï¼‰
COPY package*.json ./
RUN npm install

# 3. ä»£ç å¤åˆ¶ï¼ˆç»å¸¸å˜ï¼‰
COPY . .

# 4. æ„å»ºï¼ˆæ¯æ¬¡éƒ½å˜ï¼‰
RUN npm run build
```

#### 3. **æ˜ç¡®çš„æ ‡ç­¾ç­–ç•¥**

```dockerfile
# âŒ ä¸æ¨èï¼šæ¨¡ç³Šç‰ˆæœ¬
FROM node:14

# âœ… æ¨èï¼šå…·ä½“ç‰ˆæœ¬
FROM node:14.17.0-alpine3.13

# âœ… æ¨èï¼šä½¿ç”¨ ARG ç®¡ç†ç‰ˆæœ¬
ARG NODE_VERSION=14.17.0
FROM node:${NODE_VERSION}-alpine
```

#### 4. **å¥åº·æ£€æŸ¥**

```dockerfile
# æ·»åŠ å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD wget --quiet --tries=1 --spider http://localhost:8080/ || exit 1
```

#### 5. **å…ƒæ•°æ®æ ‡ç­¾**

```dockerfile
LABEL maintainer="your-email@example.com"
LABEL version="1.0"
LABEL description="KityMinder è„‘å›¾åº”ç”¨"
```

---

### ğŸ›¡ï¸ å®‰å…¨æœ€ä½³å®è·µ

#### 1. **ä¸è¦ä»¥ root è¿è¡Œ**

```dockerfile
# åˆ›å»ºéç‰¹æƒç”¨æˆ·
RUN addgroup -S appgroup && adduser -S appuser -G appgroup
USER appuser
```

#### 2. **æ‰«ææ¼æ´**

```bash
# ä½¿ç”¨ Trivy æ‰«æé•œåƒ
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
    aquasec/trivy image myimage:latest
```

#### 3. **ä¸è¦åœ¨é•œåƒä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯**

```dockerfile
# âŒ é”™è¯¯ï¼šå¯†é’¥åœ¨é•œåƒä¸­
ENV API_KEY=secret123

# âœ… æ­£ç¡®ï¼šè¿è¡Œæ—¶ä¼ å…¥
docker run -e API_KEY=$API_KEY myimage
```

#### 4. **ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºéš”ç¦»ç§˜å¯†**

```dockerfile
# æ„å»ºé˜¶æ®µå¯èƒ½éœ€è¦ç§é’¥ï¼ˆå¦‚ SSH keyï¼‰
FROM node:14-alpine AS builder
RUN --mount=type=secret,id=github_token \
    npm config set //npm.pkg.github.com/:_authToken=$(cat /run/secrets/github_token)

# è¿è¡Œé˜¶æ®µä¸åŒ…å«ç§˜å¯†
FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
```

---

### ğŸ“¦ é’ˆå¯¹ä¸åŒè¯­è¨€çš„æœ€ä½³å®è·µ

#### Node.js é¡¹ç›®

```dockerfile
FROM node:14-alpine AS builder

WORKDIR /app

# åˆ†ç¦»ä¾èµ–å®‰è£…
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶ä»£ç 
COPY . .

# æ„å»º
RUN npm run build

# è¿è¡Œæ—¶
FROM node:14-alpine
WORKDIR /app
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/node_modules ./node_modules
CMD ["node", "dist/index.js"]
```

#### Python é¡¹ç›®

```dockerfile
FROM python:3.9-alpine AS builder

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶ä»£ç 
COPY . .

# è¿è¡Œæ—¶
FROM python:3.9-alpine
WORKDIR /app
COPY --from=builder /usr/local/lib/python3.9/site-packages /usr/local/lib/python3.9/site-packages
COPY --from=builder /app .
CMD ["python", "app.py"]
```

#### Go é¡¹ç›®ï¼ˆé™æ€ç¼–è¯‘ï¼‰

```dockerfile
# æ„å»ºé˜¶æ®µ
FROM golang:1.19-alpine AS builder

WORKDIR /app
COPY . .

# é™æ€ç¼–è¯‘
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .

# è¿è¡Œæ—¶ï¼šä½¿ç”¨ scratchï¼ˆæœ€å°ï¼‰
FROM scratch
COPY --from=builder /app/main /main
CMD ["/main"]
```

---

### ğŸ”§ è°ƒè¯•æŠ€å·§

#### 1. **æŸ¥çœ‹é•œåƒå†å²**

```bash
# æŸ¥çœ‹æ¯ä¸€å±‚çš„å¤§å°
docker history myimage:latest

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
docker history --no-trunc myimage:latest
```

#### 2. **è¿›å…¥ä¸­é—´å±‚è°ƒè¯•**

```bash
# æ„å»ºç‰¹å®šé˜¶æ®µ
docker build --target builder -t debug .

# è¿›å…¥å®¹å™¨è°ƒè¯•
docker run -it debug sh
```

#### 3. **ä½¿ç”¨ dive åˆ†æé•œåƒ**

```bash
# å®‰è£… dive
brew install dive  # macOS
# æˆ– https://github.com/wagoodman/dive

# åˆ†æé•œåƒ
dive myimage:latest
```

---

### ğŸ“š æ¨èèµ„æº

#### å®˜æ–¹æ–‡æ¡£
- [Dockerfile æœ€ä½³å®è·µ](https://docs.docker.com/develop/develop-images/dockerfile_best-practices/)
- [å¤šé˜¶æ®µæ„å»ºæŒ‡å—](https://docs.docker.com/build/building/multi-stage/)

#### å·¥å…·
- [Dive](https://github.com/wagoodman/dive) - é•œåƒå±‚åˆ†æå·¥å…·
- [Trivy](https://github.com/aquasecurity/trivy) - æ¼æ´æ‰«æ
- [Hadolint](https://github.com/hadolint/hadolint) - Dockerfile è¯­æ³•æ£€æŸ¥

#### æ–‡ç« 
- [Google Distroless é•œåƒ](https://github.com/GoogleContainerTools/distroless)
- [Alpine vs Debian](https://medium.com/swlh/alpine-slim-stretch-buster-jessie-bullseye-bookworm-what-are-the-differences-in-docker-62171ed4531d)

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å¤šé˜¶æ®µæ„å»ºæ˜¯å…³é”®**
   - æ„å»ºç¯å¢ƒå’Œè¿è¡Œç¯å¢ƒåˆ†ç¦»
   - åªä¿ç•™å¿…è¦çš„æ–‡ä»¶

2. **é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ**
   - Alpine é€‚åˆå¤§å¤šæ•°åœºæ™¯
   - é™æ€ç½‘ç«™ä½¿ç”¨ Nginx/Caddy
   - Go ç­‰å¯ä»¥ä½¿ç”¨ scratch

3. **åˆå¹¶ RUN æŒ‡ä»¤**
   - å‡å°‘é•œåƒå±‚æ•°
   - åœ¨åŒä¸€å±‚æ¸…ç†ç¼“å­˜

4. **åˆ©ç”¨ç¼“å­˜æœºåˆ¶**
   - åˆ†ç¦»ä¾èµ–å®‰è£…
   - æŠŠå˜åŒ–å°‘çš„æ”¾å‰é¢

5. **ä¸è¦è¿‡åº¦ä¼˜åŒ–**
   - ä» 1.2GB åˆ° 25MB å·²ç»å¾ˆå¥½
   - ç»§ç»­ä¼˜åŒ–åˆ° 5MB å¯èƒ½ä¸å€¼å¾—
   - å¹³è¡¡ä½“ç§¯ã€å¤æ‚åº¦ã€ç»´æŠ¤æˆæœ¬

### ä¼˜åŒ–è·¯å¾„å»ºè®®

```
åˆå­¦è€…ï¼ˆå¿…å­¦ï¼‰:
  â”œâ”€ å¤šé˜¶æ®µæ„å»º â­â­â­â­â­
  â”œâ”€ Alpine é•œåƒ â­â­â­â­â­
  â””â”€ åˆå¹¶ RUN æŒ‡ä»¤ â­â­â­â­â­

è¿›é˜¶ï¼ˆæ¨èï¼‰:
  â”œâ”€ æ›´æ¢è¿è¡Œæ—¶é•œåƒ (Nginx) â­â­â­â­
  â”œâ”€ åˆ†ç¦»ä¾èµ–å±‚ â­â­â­â­
  â””â”€ BuildKit ç¼“å­˜ â­â­â­â­

é«˜çº§ï¼ˆå¯é€‰ï¼‰:
  â”œâ”€ é¢„å‹ç¼©èµ„æº â­â­â­
  â”œâ”€ Distroless â­â­
  â””â”€ è‡ªå®šä¹‰æœ€å°é•œåƒ â­
```

### æœ€ç»ˆå»ºè®®

å¯¹äºå¤§å¤šæ•°é¡¹ç›®ï¼Œ**Nginx å¤šé˜¶æ®µæ„å»ºç‰ˆæœ¬æ˜¯æœ€ä½³é€‰æ‹©**ï¼š

- âœ… é•œåƒå°ï¼ˆ~25MBï¼‰
- âœ… æ€§èƒ½å¥½
- âœ… é…ç½®ç®€å•
- âœ… æ˜“äºç»´æŠ¤
- âœ… ç”Ÿäº§çº§ç¨³å®šæ€§

---

## ğŸš€ ç°åœ¨å¼€å§‹ä¼˜åŒ–ä½ çš„ Dockerfileï¼

è®°ä½ï¼š
- ä»ç®€å•å¼€å§‹ï¼Œé€æ­¥ä¼˜åŒ–
- ä¸è¦è¿‡åº¦ä¼˜åŒ–
- æµ‹è¯•æ¯ä¸€æ­¥çš„æ”¹è¿›
- è€ƒè™‘å›¢é˜Ÿçš„ç»´æŠ¤èƒ½åŠ›

**Happy Dockering! ğŸ³**

---

> ğŸ’¡ **æç¤º**ï¼šè¿™ä»½æŒ‡å—åŸºäº KityMinder é¡¹ç›®çš„å®é™…ä¼˜åŒ–ç»éªŒï¼Œä½ å¯ä»¥å°†è¿™äº›æŠ€å·§åº”ç”¨åˆ°ä»»ä½•é¡¹ç›®ä¸­ã€‚
>
> ğŸ“§ **åé¦ˆ**ï¼šå¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issueï¼

---

*æœ€åæ›´æ–°ï¼š2026-01-13*
