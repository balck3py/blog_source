---
title: .NET å¤šçº¿ç¨‹é‚£äº›äº‹ï¼šThreadã€ThreadPoolã€Taskã€Async/Await å®Œå…¨æŒ‡å—
date: 2025-12-15
author: Eugen
tags:
  - .NET
  - å¤šçº¿ç¨‹
  - Thread
  - ThreadPool
  - Task
  - async/await
  - å¼‚æ­¥ç¼–ç¨‹
  - å¹¶å‘æ§åˆ¶
  - æ€§èƒ½ä¼˜åŒ–
---
# ğŸ§µ .NET å¤šçº¿ç¨‹é‚£äº›äº‹ï¼šThreadã€ThreadPoolã€Taskã€Async/Await å®Œå…¨æŒ‡å—

> ğŸ“š æœ¬æ–‡è¯¦ç»†ä»‹ç» .NET Framework å’Œ .NET Core ç”Ÿæ€ä¸‹çš„å¤šçº¿ç¨‹ä¸å¼‚æ­¥æœºåˆ¶ï¼ŒåŒ…æ‹¬åº•å±‚åŸç†ã€æ€§èƒ½å·®å¼‚ã€é€‚ç”¨åœºæ™¯å’Œæœ€ä½³å®è·µã€‚

---

## ğŸ“‘ ç›®å½•

1. [åŸºç¡€æ¦‚å¿µ](#ä¸€-åŸºç¡€æ¦‚å¿µ)
2. [Thread çº¿ç¨‹è¯¦è§£](#äºŒ-thread-çº¿ç¨‹è¯¦è§£)
3. [ThreadPool çº¿ç¨‹æ± è¯¦è§£](#ä¸‰-threadpool-çº¿ç¨‹æ± è¯¦è§£)
4. [Task ä»»åŠ¡è¯¦è§£](#å››-task-ä»»åŠ¡è¯¦è§£)
5. [async/await å¼‚æ­¥ç¼–ç¨‹è¯¦è§£](#äº”-asyncawait-å¼‚æ­¥ç¼–ç¨‹è¯¦è§£)
6. [åº•å±‚åŸç†æ·±å…¥](#å…­-åº•å±‚åŸç†æ·±å…¥)
7. [å¸¸è§é—®é¢˜æ·±åº¦è§£æ](#ä¸ƒ-å¸¸è§é—®é¢˜æ·±åº¦è§£æ)
8. [ä¿¡å·é‡ä¸å¹¶å‘æ§åˆ¶](#å…«-ä¿¡å·é‡ä¸å¹¶å‘æ§åˆ¶)
9. [æ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ](#ä¹-æ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ)
10. [.NET Framework vs .NET Core å·®å¼‚](#å-net-framework-vs-net-core-å·®å¼‚)

---

## ä¸€ã€ åŸºç¡€æ¦‚å¿µ

### 1.1 ğŸ  è¿›ç¨‹ä¸çº¿ç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         è¿›ç¨‹ (Process)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   çº¿ç¨‹ Thread 1  â”‚  â”‚   çº¿ç¨‹ Thread 2  â”‚  â”‚   çº¿ç¨‹ Thread 3  â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚  æ ˆç©ºé—´  â”‚   â”‚  â”‚   â”‚  æ ˆç©ºé—´  â”‚   â”‚  â”‚   â”‚  æ ˆç©ºé—´  â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              å…±äº«å†…å­˜ç©ºé—´ (å †ã€é™æ€å˜é‡ç­‰)                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **è¿›ç¨‹**ï¼šæ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜ç©ºé—´
- **çº¿ç¨‹**ï¼šCPU è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œå…±äº«è¿›ç¨‹çš„å†…å­˜ç©ºé—´

### 1.2 ğŸ”„ åŒæ­¥ vs å¼‚æ­¥ vs å¹¶è¡Œ vs å¹¶å‘

| æ¦‚å¿µ | è¯´æ˜ | ç±»æ¯” |
|------|------|------|
| **åŒæ­¥ (Synchronous)** | æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªå®Œæˆæ‰æ‰§è¡Œä¸‹ä¸€ä¸ª | ğŸ« æ’é˜Ÿä¹°ç¥¨ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ª |
| **å¼‚æ­¥ (Asynchronous)** | å‘èµ·æ“ä½œåä¸ç­‰å¾…ç»“æœï¼Œç»§ç»­åšå…¶ä»–äº‹ | ğŸ• ç‚¹å¤–å–åç»§ç»­å·¥ä½œï¼Œå¤–å–åˆ°äº†å†å»æ‹¿ |
| **å¹¶è¡Œ (Parallel)** | å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ | ğŸª å¤šä¸ªçª—å£åŒæ—¶å–ç¥¨ |
| **å¹¶å‘ (Concurrent)** | å¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œï¼ˆçœ‹èµ·æ¥åŒæ—¶ï¼‰ | ğŸƒ ä¸€ä¸ªäººåœ¨å¤šä¸ªçª—å£é—´æ¥å›è·‘ |

> ğŸ’¡ **å°ç»“**ï¼šåŒæ­¥æ˜¯é˜»å¡ç­‰å¾…ï¼Œå¼‚æ­¥æ˜¯éé˜»å¡ï¼›å¹¶è¡Œéœ€è¦å¤šæ ¸ CPU çœŸæ­£åŒæ—¶æ‰§è¡Œï¼Œå¹¶å‘æ˜¯å•æ ¸ä¸Šçš„æ—¶é—´ç‰‡è½®è½¬ã€‚

---

## äºŒã€ Thread çº¿ç¨‹è¯¦è§£

### 2.1 ğŸ¯ ä»€ä¹ˆæ˜¯ Threadï¼Ÿ

`Thread` æ˜¯ .NET ä¸­æœ€åŸºç¡€çš„çº¿ç¨‹ç±»ï¼Œç›´æ¥æ˜ å°„åˆ°æ“ä½œç³»ç»Ÿçº¿ç¨‹ã€‚æ¯åˆ›å»ºä¸€ä¸ª `Thread` å¯¹è±¡ï¼Œå°±ä¼šè¯·æ±‚æ“ä½œç³»ç»Ÿåˆ†é…ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚

### 2.2 ğŸ“Š Thread çš„ç”Ÿå‘½å‘¨æœŸ

```
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Unstarted â”‚  â† åˆ›å»ºåçš„åˆå§‹çŠ¶æ€
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚ Start()
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Running  â”‚  â† æ­£åœ¨æ‰§è¡Œ
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
    â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Wait â”‚  â”‚Stoppedâ”‚  â† æ‰§è¡Œå®Œæ¯•æˆ–å¼‚å¸¸ç»ˆæ­¢
â”‚Blockedâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”¬â”€â”€â”€â”˜
   â”‚ è¢«å”¤é†’
   â””â”€â”€â”€â”€â”€â”€â–º Running
```

### 2.3 ğŸ’» Thread ä»£ç ç¤ºä¾‹

```csharp
using System;
using System.Threading;

class ThreadExample
{
    static void Main()
    {
        // æ–¹å¼1ï¼šä½¿ç”¨ ThreadStart å§”æ‰˜ï¼ˆæ— å‚æ•°ï¼‰
        Thread thread1 = new Thread(new ThreadStart(DoWork));
        thread1.Name = "WorkerThread1";
        thread1.Start();

        // æ–¹å¼2ï¼šä½¿ç”¨ Lambda è¡¨è¾¾å¼
        Thread thread2 = new Thread(() =>
        {
            for (int i = 0; i < 5; i++)
            {
                Console.WriteLine($"Thread2 is working... {i}");
                Thread.Sleep(100);
            }
        });
        thread2.Start();

        // æ–¹å¼3ï¼šä½¿ç”¨ ParameterizedThreadStartï¼ˆå¸¦å‚æ•°ï¼‰
        Thread thread3 = new Thread(DoWorkWithParam);
        thread3.Start("Hello from parameter!");

        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ
        thread1.Join();
        thread2.Join();
        thread3.Join();

        Console.WriteLine("All threads completed.");
    }

    static void DoWork()
    {
        Console.WriteLine($"Thread {Thread.CurrentThread.Name} started.");
        Thread.Sleep(500);
        Console.WriteLine($"Thread {Thread.CurrentThread.Name} finished.");
    }

    static void DoWorkWithParam(object? param)
    {
        Console.WriteLine($"Received parameter: {param}");
    }
}
```

### 2.4 ğŸ“‹ Thread çš„é‡è¦å±æ€§å’Œæ–¹æ³•

| å±æ€§/æ–¹æ³• | è¯´æ˜ |
|-----------|------|
| `Name` | è®¾ç½®/è·å–çº¿ç¨‹åç§°ï¼ˆè°ƒè¯•ç”¨ï¼‰ |
| `Priority` | è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ (Lowest ~ Highest) |
| `IsBackground` | æ˜¯å¦ä¸ºåå°çº¿ç¨‹ï¼ˆåå°çº¿ç¨‹ä¸é˜»æ­¢è¿›ç¨‹é€€å‡ºï¼‰ |
| `IsAlive` | çº¿ç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ |
| `Start()` | å¯åŠ¨çº¿ç¨‹ |
| `Join()` | ç­‰å¾…çº¿ç¨‹å®Œæˆ |
| `Sleep()` | è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ—¶é—´ |
| `Interrupt()` | ä¸­æ–­ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ |

### 2.5 ğŸ’° Thread çš„èµ„æºå¼€é”€

```
æ¯åˆ›å»ºä¸€ä¸ªçº¿ç¨‹çš„å¼€é”€ï¼š
â”œâ”€â”€ å†…æ ¸å¯¹è±¡ï¼šçº¦ 700 å­—èŠ‚
â”œâ”€â”€ çº¿ç¨‹ç¯å¢ƒå—(TEB)ï¼šçº¦ 4KB
â”œâ”€â”€ ç”¨æˆ·æ¨¡å¼æ ˆï¼šé»˜è®¤ 1MB (å¯é…ç½®)
â”œâ”€â”€ å†…æ ¸æ¨¡å¼æ ˆï¼šçº¦ 12KB (32ä½) / 24KB (64ä½)
â””â”€â”€ DLL çº¿ç¨‹é€šçŸ¥
```

> âš ï¸ **è­¦å‘Š**ï¼šé¢‘ç¹åˆ›å»º/é”€æ¯çº¿ç¨‹ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼

> ğŸ’¡ **å°ç»“**ï¼šThread æä¾›æœ€åº•å±‚çš„çº¿ç¨‹æ§åˆ¶ï¼Œä½†åˆ›å»ºå¼€é”€å¤§ï¼ˆ~1MBå†…å­˜ï¼‰ï¼Œé€‚åˆéœ€è¦ç²¾ç¡®æ§åˆ¶çº¿ç¨‹è¡Œä¸ºçš„åœºæ™¯ï¼Œå¦‚è®¾ç½®ä¼˜å…ˆçº§ã€é•¿æ—¶é—´è¿è¡Œçš„åå°æœåŠ¡ã€‚æ—¥å¸¸å¼€å‘ä¸­åº”ä¼˜å…ˆä½¿ç”¨ Taskã€‚

---

## ä¸‰ã€ ThreadPool çº¿ç¨‹æ± è¯¦è§£

### 3.1 ğŸŠ ä»€ä¹ˆæ˜¯ ThreadPoolï¼Ÿ

`ThreadPool` æ˜¯ .NET æä¾›çš„æ‰˜ç®¡çº¿ç¨‹æ± ï¼Œå®ƒç»´æŠ¤ä¸€ç»„é¢„å…ˆåˆ›å»ºçš„çº¿ç¨‹ï¼Œä»»åŠ¡å®Œæˆåçº¿ç¨‹ä¸ä¼šé”€æ¯ï¼Œè€Œæ˜¯è¿”å›æ± ä¸­ç­‰å¾…ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚

### 3.2 âš™ï¸ ThreadPool å·¥ä½œåŸç†

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              ThreadPool                      â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚           å…¨å±€ä»»åŠ¡é˜Ÿåˆ—                   â”‚â”‚
â”‚  Task 1  â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  â”‚  [Task1][Task2][Task3][Task4][Task5]    â”‚â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  Task 2  â”‚        â”‚                   â”‚                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  Task 3  â”‚        â”‚  â–¼                â–¼                â–¼        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  Task 4  â”‚        â”‚ â”‚Threadâ”‚      â”‚Threadâ”‚      â”‚Threadâ”‚       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚ â”‚  #1  â”‚      â”‚  #2  â”‚      â”‚  #3  â”‚       â”‚
â”‚  Task 5  â”‚        â”‚ â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”Œâ”€â”€â”€â”         â”Œâ”€â”€â”€â”         â”Œâ”€â”€â”€â”         â”‚
                    â”‚  â”‚æœ¬åœ°â”‚         â”‚æœ¬åœ°â”‚         â”‚æœ¬åœ°â”‚         â”‚
                    â”‚  â”‚é˜Ÿåˆ—â”‚         â”‚é˜Ÿåˆ—â”‚         â”‚é˜Ÿåˆ—â”‚         â”‚
                    â”‚  â””â”€â”€â”€â”˜         â””â”€â”€â”€â”˜         â””â”€â”€â”€â”˜         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ğŸ’» ThreadPool ä»£ç ç¤ºä¾‹

```csharp
using System;
using System.Threading;

class ThreadPoolExample
{
    static void Main()
    {
        // æŸ¥çœ‹çº¿ç¨‹æ± é…ç½®
        ThreadPool.GetMinThreads(out int minWorker, out int minIO);
        ThreadPool.GetMaxThreads(out int maxWorker, out int maxIO);
        Console.WriteLine($"Worker Threads: Min={minWorker}, Max={maxWorker}");
        Console.WriteLine($"IO Threads: Min={minIO}, Max={maxIO}");

        // æ–¹å¼1ï¼šQueueUserWorkItem æ— å‚æ•°
        ThreadPool.QueueUserWorkItem(_ =>
        {
            Console.WriteLine($"Task 1 running on thread {Environment.CurrentManagedThreadId}");
        });

        // æ–¹å¼2ï¼šQueueUserWorkItem å¸¦å‚æ•°
        ThreadPool.QueueUserWorkItem(state =>
        {
            Console.WriteLine($"Task 2 received: {state}");
        }, "Hello ThreadPool!");

        // æ–¹å¼3ï¼šä½¿ç”¨ WaitCallback å§”æ‰˜
        WaitCallback callback = obj =>
        {
            int number = (int)obj!;
            Console.WriteLine($"Processing number: {number}");
        };
        
        for (int i = 0; i < 5; i++)
        {
            ThreadPool.QueueUserWorkItem(callback, i);
        }

        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼ˆç®€å•æ–¹å¼ï¼‰
        Thread.Sleep(2000);
        Console.WriteLine("All tasks completed.");
    }
}
```

### 3.4 ğŸ”§ ThreadPool é…ç½®

```csharp
// è·å–å½“å‰é…ç½®
ThreadPool.GetMinThreads(out int minWorker, out int minIO);
ThreadPool.GetMaxThreads(out int maxWorker, out int maxIO);
Console.WriteLine($"å·¥ä½œçº¿ç¨‹: Min={minWorker}, Max={maxWorker}");
Console.WriteLine($"I/Oçº¿ç¨‹: Min={minIO}, Max={maxIO}");

// è®¾ç½®çº¿ç¨‹æ± çº¿ç¨‹æ•°
ThreadPool.SetMinThreads(workerThreads: 50, completionPortThreads: 50);
ThreadPool.SetMaxThreads(workerThreads: 200, completionPortThreads: 200);
```

**é»˜è®¤å€¼ï¼š**

| ç‰ˆæœ¬ | æœ€å°çº¿ç¨‹æ•° (Min) | æœ€å¤§çº¿ç¨‹æ•° (Max) |
|------|------------------|------------------|
| .NET Framework | CPU æ ¸å¿ƒæ•° | ~32,767 |
| .NET Core/.NET 5+ | CPU æ ¸å¿ƒæ•° | ~32,767 Ã— CPUæ ¸å¿ƒæ•° |

### 3.5 ğŸ§® æœ€ä½³çº¿ç¨‹æ•°è®¡ç®—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æœ€ä½³çº¿ç¨‹æ•°è®¡ç®—                                  â”‚
â”‚                                                                     â”‚
â”‚  CPU å¯†é›†å‹ä»»åŠ¡:                                                     â”‚
â”‚    æœ€ä½³çº¿ç¨‹æ•° â‰ˆ CPUæ ¸å¿ƒæ•° æˆ– CPUæ ¸å¿ƒæ•° + 1                            â”‚
â”‚    åŸå› : è¿‡å¤šçº¿ç¨‹åªä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€                                â”‚
â”‚                                                                     â”‚
â”‚  I/O å¯†é›†å‹ä»»åŠ¡:                                                     â”‚
â”‚    æœ€ä½³çº¿ç¨‹æ•° â‰ˆ CPUæ ¸å¿ƒæ•° Ã— (1 + ç­‰å¾…æ—¶é—´/è®¡ç®—æ—¶é—´)                   â”‚
â”‚    ä¾‹å¦‚: 12æ ¸ CPUï¼Œä»»åŠ¡ 80% æ—¶é—´åœ¨ç­‰å¾… I/O                            â”‚
â”‚         çº¿ç¨‹æ•° â‰ˆ 12 Ã— (1 + 0.8/0.2) = 12 Ã— 5 = 60                   â”‚
â”‚                                                                     â”‚
â”‚  æ··åˆå‹ä»»åŠ¡:                                                         â”‚
â”‚    éœ€è¦é€šè¿‡æ€§èƒ½æµ‹è¯•æ¥ç¡®å®šæœ€ä½³å€¼                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.6 ğŸ“Š Thread vs ThreadPool å¯¹æ¯”

| ç‰¹æ€§ | Thread | ThreadPool |
|------|--------|------------|
| åˆ›å»ºå¼€é”€ | é«˜ï¼ˆæ¯æ¬¡åˆ›å»ºæ–°çº¿ç¨‹ï¼‰ | ä½ï¼ˆå¤ç”¨ç°æœ‰çº¿ç¨‹ï¼‰ |
| èµ„æºç®¡ç† | æ‰‹åŠ¨ç®¡ç† | è‡ªåŠ¨ç®¡ç† |
| çº¿ç¨‹æ•°é‡æ§åˆ¶ | æ— é™åˆ¶ï¼ˆå¯èƒ½è€—å°½èµ„æºï¼‰ | æœ‰ä¸Šé™ï¼Œæ™ºèƒ½è°ƒæ•´ |
| é€‚åˆåœºæ™¯ | é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ | çŸ­å°é¢‘ç¹çš„ä»»åŠ¡ |
| çº¿ç¨‹ä¼˜å…ˆçº§ | âœ… å¯è®¾ç½® | âŒ ä¸å¯è®¾ç½® |
| å‰å°/åå°çº¿ç¨‹ | âœ… å¯è®¾ç½® | âŒ åªèƒ½æ˜¯åå°çº¿ç¨‹ |

> ğŸ’¡ **å°ç»“**ï¼šThreadPool é€šè¿‡çº¿ç¨‹å¤ç”¨å¤§å¹…å‡å°‘äº†åˆ›å»ºå¼€é”€ï¼Œé€‚åˆçŸ­å°é¢‘ç¹çš„ä»»åŠ¡ã€‚ä½†è¦æ³¨æ„è®¾ç½®åˆç†çš„ MinThreads ä»¥åº”å¯¹çªå‘æµé‡ï¼Œé¿å…çº¿ç¨‹æ± "é¥¥é¥¿"ã€‚

---

## å››ã€ Task ä»»åŠ¡è¯¦è§£

### 4.1 ğŸš€ ä»€ä¹ˆæ˜¯ Taskï¼Ÿ

`Task` æ˜¯ .NET 4.0 å¼•å…¥çš„ä»»åŠ¡å¹¶è¡Œåº“ (TPL) çš„æ ¸å¿ƒç±»ï¼Œå®ƒæ˜¯å¯¹çº¿ç¨‹æ± çš„æ›´é«˜çº§å°è£…ï¼Œæä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½ã€‚

### 4.2 ğŸ—ï¸ Task çš„å±‚æ¬¡ç»“æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Task/Task<T>      â”‚
                    â”‚   (é«˜çº§æŠ½è±¡)          â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ åŸºäº
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     TaskScheduler     â”‚
                    â”‚   (ä»»åŠ¡è°ƒåº¦å™¨)         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ é»˜è®¤ä½¿ç”¨
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     ThreadPool        â”‚
                    â”‚   (çº¿ç¨‹æ± )            â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚ ç®¡ç†
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  OS Threads (CLR)     â”‚
                    â”‚   (æ“ä½œç³»ç»Ÿçº¿ç¨‹)       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ğŸ’» Task ä»£ç ç¤ºä¾‹

```csharp
using System;
using System.Threading;
using System.Threading.Tasks;

class TaskExample
{
    static async Task Main()
    {
        // === åˆ›å»º Task çš„å¤šç§æ–¹å¼ ===
        
        // æ–¹å¼1ï¼šTask.Run (æ¨è)
        Task task1 = Task.Run(() =>
        {
            Console.WriteLine($"Task.Run on thread {Environment.CurrentManagedThreadId}");
        });

        // æ–¹å¼2ï¼šTask.Factory.StartNew
        Task task2 = Task.Factory.StartNew(() =>
        {
            Console.WriteLine($"Task.Factory on thread {Environment.CurrentManagedThreadId}");
        });

        // æ–¹å¼3ï¼šnew Task + Start (ä¸æ¨è)
        Task task3 = new Task(() =>
        {
            Console.WriteLine($"new Task on thread {Environment.CurrentManagedThreadId}");
        });
        task3.Start();

        // === Task<T> å¸¦è¿”å›å€¼ ===
        Task<int> taskWithResult = Task.Run(() =>
        {
            Thread.Sleep(100);
            return 42;
        });
        
        int result = await taskWithResult;
        Console.WriteLine($"Result: {result}");

        // === Task çš„ç»„åˆ ===
        
        // WhenAllï¼šç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
        Task[] tasks = new Task[3];
        for (int i = 0; i < 3; i++)
        {
            int index = i;
            tasks[i] = Task.Run(() =>
            {
                Thread.Sleep(100 * (index + 1));
                Console.WriteLine($"Task {index} completed");
            });
        }
        await Task.WhenAll(tasks);
        Console.WriteLine("All tasks completed");

        // WhenAnyï¼šä»»æ„ä¸€ä¸ªä»»åŠ¡å®Œæˆ
        Task<int>[] numberTasks =
        {
            Task.Run(() => { Thread.Sleep(300); return 1; }),
            Task.Run(() => { Thread.Sleep(100); return 2; }),
            Task.Run(() => { Thread.Sleep(200); return 3; })
        };
        Task<int> firstCompleted = await Task.WhenAny(numberTasks);
        Console.WriteLine($"First completed: {await firstCompleted}");

        // === ä»»åŠ¡å–æ¶ˆ ===
        CancellationTokenSource cts = new CancellationTokenSource();
        CancellationToken token = cts.Token;

        Task cancellableTask = Task.Run(() =>
        {
            for (int i = 0; i < 100; i++)
            {
                token.ThrowIfCancellationRequested();
                Console.WriteLine($"Working... {i}");
                Thread.Sleep(50);
            }
        }, token);

        cts.CancelAfter(500); // 500ms åå–æ¶ˆ

        try
        {
            await cancellableTask;
        }
        catch (OperationCanceledException)
        {
            Console.WriteLine("Task was cancelled.");
        }
    }
}
```

### 4.4 ğŸ“ˆ Task çš„çŠ¶æ€æœº

```
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚       Created           â”‚
                          â”‚    (æ–°å»ºï¼Œæœªå¯åŠ¨)        â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ Start() / Run()
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   WaitingToRun          â”‚
                          â”‚   (ç­‰å¾…è°ƒåº¦)             â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ çº¿ç¨‹æ± åˆ†é…çº¿ç¨‹
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚      Running            â”‚
                          â”‚      (è¿è¡Œä¸­)           â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚RanToCompletion  â”‚    â”‚    Faulted      â”‚    â”‚   Canceled      â”‚
    â”‚   (æˆåŠŸå®Œæˆ)     â”‚    â”‚   (å¼‚å¸¸ç»ˆæ­¢)    â”‚    â”‚   (å·²å–æ¶ˆ)       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 ğŸ†š Task.Run vs Task.Factory.StartNew

| ç‰¹æ€§ | Task.Run | Task.Factory.StartNew |
|------|----------|----------------------|
| ç®€æ´æ€§ | âœ… æ›´ç®€æ´ | âŒ éœ€è¦æ›´å¤šå‚æ•° |
| é»˜è®¤è°ƒåº¦å™¨ | ThreadPool | å½“å‰ TaskScheduler |
| åµŒå¥— Task | è‡ªåŠ¨ Unwrap | è¿”å› Task<Task> |
| æ¨èç¨‹åº¦ | âœ… é¦–é€‰ | âš ï¸ ç‰¹æ®Šåœºæ™¯ä½¿ç”¨ |

> ğŸ’¡ **å°ç»“**ï¼šTask æ˜¯ç°ä»£ .NET å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ï¼Œæä¾›äº†ä»»åŠ¡ç»„åˆã€å–æ¶ˆã€å¼‚å¸¸å¤„ç†ç­‰é«˜çº§åŠŸèƒ½ã€‚Task.Run æ˜¯æ‰§è¡Œåå°ä»»åŠ¡çš„é¦–é€‰æ–¹å¼ï¼Œå®ƒè‡ªåŠ¨ä½¿ç”¨çº¿ç¨‹æ± ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸã€‚

---

## äº”ã€ async/await å¼‚æ­¥ç¼–ç¨‹è¯¦è§£

### 5.1 âœ¨ ä»€ä¹ˆæ˜¯ async/awaitï¼Ÿ

`async/await` æ˜¯ C# 5.0 (.NET 4.5) å¼•å…¥çš„å¼‚æ­¥ç¼–ç¨‹å…³é”®å­—ï¼Œå®ƒè®©å¼‚æ­¥ä»£ç å†™èµ·æ¥åƒåŒæ­¥ä»£ç ä¸€æ ·ç›´è§‚ã€‚

### 5.2 ğŸ”„ async/await å·¥ä½œæµç¨‹

```
                è°ƒç”¨ async æ–¹æ³•
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    é‡åˆ° await ä¹‹å‰       â”‚
        â”‚    åŒæ­¥æ‰§è¡Œä»£ç           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    é‡åˆ° await å…³é”®å­—     â”‚
        â”‚    æ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦å®Œæˆ   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â”‚
          â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å·²å®Œæˆ     â”‚      â”‚   æœªå®Œæˆ       â”‚
    â”‚ ç»§ç»­åŒæ­¥   â”‚      â”‚   â‘  æ•è·ä¸Šä¸‹æ–‡ â”‚
    â”‚ æ‰§è¡Œ       â”‚      â”‚   â‘¡ æ³¨å†Œå›è°ƒ   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â‘¢ è¿”å›è°ƒç”¨æ–¹ â”‚
          â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                    â”‚ å¼‚æ­¥æ“ä½œå®Œæˆ
          â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            â”‚  æ¢å¤æ‰§è¡Œ      â”‚
          â”‚            â”‚  (å¯èƒ½åœ¨ä¸åŒ   â”‚
          â”‚            â”‚   çº¿ç¨‹ä¸Š)      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ–¹æ³•æ‰§è¡Œå®Œæ¯•   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ğŸ’» async/await ä»£ç ç¤ºä¾‹

```csharp
using System;
using System.Net.Http;
using System.Threading.Tasks;
using System.IO;
using System.Collections.Generic;
using System.Runtime.CompilerServices;

class AsyncAwaitExample
{
    static async Task Main()
    {
        Console.WriteLine($"Main started on thread {Environment.CurrentManagedThreadId}");
        
        // === åŸºç¡€ç”¨æ³• ===
        string result = await GetDataAsync();
        Console.WriteLine(result);

        // === å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œ ===
        Task<string> task1 = FetchUrlAsync("https://www.microsoft.com");
        Task<string> task2 = FetchUrlAsync("https://www.github.com");
        
        // å¹¶è¡Œç­‰å¾…æ‰€æœ‰ç»“æœ
        string[] results = await Task.WhenAll(task1, task2);
        foreach (var r in results)
        {
            Console.WriteLine($"Fetched {r.Length} characters");
        }

        // === å¼‚æ­¥æµ (C# 8.0+) ===
        await foreach (int number in GenerateNumbersAsync())
        {
            Console.WriteLine($"Received: {number}");
        }

        Console.WriteLine($"Main finished on thread {Environment.CurrentManagedThreadId}");
    }

    // åŸºç¡€å¼‚æ­¥æ–¹æ³•
    static async Task<string> GetDataAsync()
    {
        Console.WriteLine($"GetDataAsync started on thread {Environment.CurrentManagedThreadId}");
        
        await Task.Delay(1000);
        
        Console.WriteLine($"GetDataAsync resumed on thread {Environment.CurrentManagedThreadId}");
        return "Data fetched successfully!";
    }

    // ç½‘ç»œè¯·æ±‚ç¤ºä¾‹
    static async Task<string> FetchUrlAsync(string url)
    {
        using HttpClient client = new HttpClient();
        client.Timeout = TimeSpan.FromSeconds(10);
        
        try
        {
            return await client.GetStringAsync(url);
        }
        catch (HttpRequestException ex)
        {
            Console.WriteLine($"Error fetching {url}: {ex.Message}");
            return string.Empty;
        }
    }

    // å¼‚æ­¥è¿­ä»£å™¨ (C# 8.0+)
    static async IAsyncEnumerable<int> GenerateNumbersAsync(
        [EnumeratorCancellation] CancellationToken ct = default)
    {
        for (int i = 0; i < 5; i++)
        {
            await Task.Delay(100, ct);
            yield return i;
        }
    }
}
```

### 5.4 âš ï¸ async/await å¸¸è§é™·é˜±å’Œæœ€ä½³å®è·µ

```csharp
// âŒ é”™è¯¯ç¤ºä¾‹1ï¼šåŒæ­¥é˜»å¡å¼‚æ­¥æ–¹æ³• (æ­»é”é£é™©ï¼)
public void BadExample1()
{
    var result = GetDataAsync().Result; // å¯èƒ½æ­»é”ï¼
}

// âœ… æ­£ç¡®åšæ³•
public async Task GoodExample1()
{
    var result = await GetDataAsync();
}

// âŒ é”™è¯¯ç¤ºä¾‹2ï¼šasync void (é™¤äº‹ä»¶å¤„ç†ç¨‹åºå¤–ä¸è¦ä½¿ç”¨)
async void BadExample2()
{
    await Task.Delay(100);
    throw new Exception(); // å¼‚å¸¸æ— æ³•è¢«æ•è·ï¼
}

// âœ… æ­£ç¡®åšæ³•
async Task GoodExample2()
{
    await Task.Delay(100);
}

// âŒ é”™è¯¯ç¤ºä¾‹3ï¼šä¸å¿…è¦çš„ async/await
async Task<int> BadExample3()
{
    return await Task.FromResult(42); // å¤šä½™çš„ await
}

// âœ… æ­£ç¡®åšæ³•
Task<int> GoodExample3()
{
    return Task.FromResult(42);
}

// âŒ é”™è¯¯ç¤ºä¾‹4ï¼šä¸²è¡Œæ‰§è¡Œå¯å¹¶è¡Œçš„ä»»åŠ¡
async Task BadExample4()
{
    var result1 = await FetchData1Async(); // ç­‰å¾…å®Œæˆ
    var result2 = await FetchData2Async(); // ç„¶åæ‰å¼€å§‹
}

// âœ… æ­£ç¡®åšæ³•ï¼šå¹¶è¡Œæ‰§è¡Œ
async Task GoodExample4()
{
    var task1 = FetchData1Async(); // å¼€å§‹æ‰§è¡Œ
    var task2 = FetchData2Async(); // åŒæ—¶å¼€å§‹
    await Task.WhenAll(task1, task2); // å¹¶è¡Œç­‰å¾…
}
```

> ğŸ’¡ **å°ç»“**ï¼šasync/await æå¤§ç®€åŒ–äº†å¼‚æ­¥ç¼–ç¨‹ï¼Œè®©å¼‚æ­¥ä»£ç å¯è¯»æ€§æ¥è¿‘åŒæ­¥ä»£ç ã€‚å…³é”®è¦ç‚¹ï¼šé¿å… async voidã€é¿å… .Result/.Wait() åŒæ­¥é˜»å¡ã€åˆç†ä½¿ç”¨ Task.WhenAll å¹¶è¡Œæ‰§è¡Œã€‚

---

## å…­ã€ åº•å±‚åŸç†æ·±å…¥

### 6.1 ğŸ”§ async/await çŠ¶æ€æœºåŸç†

å½“ç¼–è¯‘å™¨é‡åˆ° `async` æ–¹æ³•æ—¶ï¼Œä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªçŠ¶æ€æœºï¼š

**æºä»£ç ï¼š**
```csharp
async Task<int> CalculateAsync()
{
    Console.WriteLine("Start");
    await Task.Delay(1000);
    Console.WriteLine("Middle");
    await Task.Delay(1000);
    Console.WriteLine("End");
    return 42;
}
```

**ç¼–è¯‘å™¨ç”Ÿæˆçš„ä¼ªä»£ç ï¼ˆç®€åŒ–ç‰ˆï¼‰ï¼š**
```csharp
// ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºç»“æ„ä½“
[AsyncStateMachine(typeof(CalculateAsync_StateMachine))]
Task<int> CalculateAsync()
{
    var stateMachine = new CalculateAsync_StateMachine();
    stateMachine._builder = AsyncTaskMethodBuilder<int>.Create();
    stateMachine._state = -1; // åˆå§‹çŠ¶æ€
    stateMachine._builder.Start(ref stateMachine);
    return stateMachine._builder.Task;
}

struct CalculateAsync_StateMachine : IAsyncStateMachine
{
    public int _state;
    public AsyncTaskMethodBuilder<int> _builder;
    private TaskAwaiter _awaiter;

    void IAsyncStateMachine.MoveNext()
    {
        int result;
        try
        {
            switch (_state)
            {
                case -1: // åˆå§‹çŠ¶æ€
                    Console.WriteLine("Start");
                    _awaiter = Task.Delay(1000).GetAwaiter();
                    if (!_awaiter.IsCompleted)
                    {
                        _state = 0;
                        _builder.AwaitUnsafeOnCompleted(ref _awaiter, ref this);
                        return; // æŒ‚èµ·ï¼Œè¿”å›è°ƒç”¨æ–¹
                    }
                    goto case 0;
                    
                case 0: // ç¬¬ä¸€ä¸ª await ä¹‹å
                    _awaiter.GetResult();
                    Console.WriteLine("Middle");
                    _awaiter = Task.Delay(1000).GetAwaiter();
                    if (!_awaiter.IsCompleted)
                    {
                        _state = 1;
                        _builder.AwaitUnsafeOnCompleted(ref _awaiter, ref this);
                        return;
                    }
                    goto case 1;
                    
                case 1: // ç¬¬äºŒä¸ª await ä¹‹å
                    _awaiter.GetResult();
                    Console.WriteLine("End");
                    result = 42;
                    break;
            }
        }
        catch (Exception ex)
        {
            _state = -2;
            _builder.SetException(ex);
            return;
        }
        
        _state = -2; // å®ŒæˆçŠ¶æ€
        _builder.SetResult(result);
    }
}
```

### 6.2 ğŸ“Š çŠ¶æ€æœºæ‰§è¡Œæµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚              è°ƒç”¨ CalculateAsync()           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  åˆ›å»ºçŠ¶æ€æœº, _state = -1                     â”‚
                    â”‚  AsyncTaskMethodBuilder.Start()             â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     MoveNext() ç¬¬1æ¬¡                        â”‚
          â”‚  _state = -1:                                             â”‚
          â”‚    1. Console.WriteLine("Start")                          â”‚
          â”‚    2. åˆ›å»º Task.Delay(1000) awaiter                       â”‚
          â”‚    3. æ£€æŸ¥æ˜¯å¦å®Œæˆ â†’ æœªå®Œæˆ                                 â”‚
          â”‚    4. _state = 0, æ³¨å†Œç»­æ¥å›è°ƒ                              â”‚
          â”‚    5. return (æŒ‚èµ·)                                        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                         Task.Delay å®Œæˆåè§¦å‘å›è°ƒ
                                      â”‚
                                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     MoveNext() ç¬¬2æ¬¡                        â”‚
          â”‚  _state = 0:                                               â”‚
          â”‚    1. GetResult() (è·å–ä¸Šä¸€ä¸ªç­‰å¾…çš„ç»“æœ)                    â”‚
          â”‚    2. Console.WriteLine("Middle")                         â”‚
          â”‚    3. åˆ›å»º Task.Delay(1000) awaiter                       â”‚
          â”‚    4. æ£€æŸ¥æ˜¯å¦å®Œæˆ â†’ æœªå®Œæˆ                                 â”‚
          â”‚    5. _state = 1, æ³¨å†Œç»­æ¥å›è°ƒ                              â”‚
          â”‚    6. return (æŒ‚èµ·)                                        â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                         Task.Delay å®Œæˆåè§¦å‘å›è°ƒ
                                      â”‚
                                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                     MoveNext() ç¬¬3æ¬¡                        â”‚
          â”‚  _state = 1:                                               â”‚
          â”‚    1. GetResult()                                          â”‚
          â”‚    2. Console.WriteLine("End")                            â”‚
          â”‚    3. result = 42                                         â”‚
          â”‚    4. _state = -2 (å®Œæˆ)                                   â”‚
          â”‚    5. SetResult(42)                                       â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.3 ğŸŒ await I/O æ“ä½œæ—¶çš„çº¿ç¨‹æµè½¬

**æ ¸å¿ƒé—®é¢˜ï¼šawait I/O æ—¶ï¼Œæœ‰çº¿ç¨‹åœ¨ç­‰å¾…å—ï¼Ÿ**

**ç­”æ¡ˆï¼šæ²¡æœ‰ï¼è¿™æ˜¯å¼‚æ­¥ I/O çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çœŸæ­£çš„å¼‚æ­¥ I/O                                    â”‚
â”‚                                                                     â”‚
â”‚  await httpClient.GetStringAsync(url):                              â”‚
â”‚                                                                     â”‚
â”‚  1. CLR è°ƒç”¨ Windows IOCP (I/O Completion Port)                     â”‚
â”‚  2. æ“ä½œç³»ç»Ÿå‘ç½‘å¡å‘é€è¯·æ±‚                                            â”‚
â”‚  3. çº¿ç¨‹ç«‹å³é‡Šæ”¾ (æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…!)                                    â”‚
â”‚  4. ç½‘å¡ç‹¬ç«‹å¤„ç†ç½‘ç»œé€šä¿¡                                              â”‚
â”‚  5. æ•°æ®è¿”å›æ—¶ï¼ŒIOCP æ”¶åˆ°ç¡¬ä»¶ä¸­æ–­                                     â”‚
â”‚  6. IOCP é€šçŸ¥ CLR                                                   â”‚
â”‚  7. CLR ä»çº¿ç¨‹æ± å–çº¿ç¨‹æ‰§è¡Œç»­æ¥ä»£ç                                     â”‚
â”‚                                                                     â”‚
â”‚  æ•´ä¸ªç­‰å¾…æœŸé—´: 0 ä¸ªçº¿ç¨‹è¢«å ç”¨ï¼                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®Œæ•´æµç¨‹å›¾ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         await I/O æ“ä½œå®Œæ•´æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  æ­¥éª¤1: è°ƒç”¨æ–¹æ³•                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ çº¿ç¨‹7 (å‡è®¾):                                                    â”‚  â”‚
â”‚  â”‚   var task = client.GetStringAsync(url);  // å‘èµ·HTTPè¯·æ±‚        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â–¼                                         â”‚
â”‚  æ­¥éª¤2: æ£€æŸ¥ Task æ˜¯å¦å®Œæˆ                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ çº¿ç¨‹7:                                                           â”‚  â”‚
â”‚  â”‚   if (!task.IsCompleted)  // HTTPè¯·æ±‚è¿˜æ²¡å®Œæˆ                     â”‚  â”‚
â”‚  â”‚   {                                                              â”‚  â”‚
â”‚  â”‚       // æ³¨å†Œç»­æ¥å›è°ƒ                                             â”‚  â”‚
â”‚  â”‚       return;  // â† çº¿ç¨‹7 è¢«é‡Šæ”¾ï¼                                â”‚  â”‚
â”‚  â”‚   }                                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â–¼                                         â”‚
â”‚  æ­¥éª¤3: çº¿ç¨‹è¿”å›çº¿ç¨‹æ±                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ çº¿ç¨‹æ± :                                                          â”‚  â”‚
â”‚  â”‚   çº¿ç¨‹7 å›åˆ°æ± ä¸­ï¼Œå¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚                                  â”‚  â”‚
â”‚  â”‚   [çº¿ç¨‹7: ç©ºé—²] [çº¿ç¨‹8: å¤„ç†è¯·æ±‚A] [çº¿ç¨‹9: å¤„ç†è¯·æ±‚B]              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â”‚  (æ­¤æ—¶æ²¡æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼)                   â”‚
â”‚                              â”‚  (æ“ä½œç³»ç»Ÿ/ç½‘å¡å¤„ç†ç½‘ç»œI/O)               â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â–¼                                         â”‚
â”‚  æ­¥éª¤4: I/O å®Œæˆï¼ŒIOCP é€šçŸ¥                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ“ä½œç³»ç»Ÿ:                                                        â”‚  â”‚
â”‚  â”‚   HTTPå“åº”åˆ°è¾¾ â†’ I/Oå®Œæˆç«¯å£(IOCP)æ”¶åˆ°é€šçŸ¥                        â”‚  â”‚
â”‚  â”‚   â†’ å°†ç»­æ¥ä»»åŠ¡æ’å…¥çº¿ç¨‹æ± é˜Ÿåˆ—                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                                         â”‚
â”‚                              â–¼                                         â”‚
â”‚  æ­¥éª¤5: æ¢å¤æ‰§è¡Œ                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ çº¿ç¨‹12 (å¯èƒ½æ˜¯ä»»æ„ç©ºé—²çº¿ç¨‹):                                      â”‚  â”‚
â”‚  â”‚   // ä» await ä¹‹åç»§ç»­æ‰§è¡Œ                                        â”‚  â”‚
â”‚  â”‚   string result = awaiter.GetResult();                          â”‚  â”‚
â”‚  â”‚   return result;                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ğŸ’¡ **å°ç»“**ï¼šasync/await çš„é­”æ³•åœ¨äºç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœºã€‚await I/O æ“ä½œæ—¶ä¸ä¼šé˜»å¡ä»»ä½•çº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿé€šè¿‡ IOCP æœºåˆ¶åœ¨ I/O å®Œæˆæ—¶é€šçŸ¥ CLRï¼Œè¿™æ˜¯é«˜æ€§èƒ½å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€ã€‚

---

## ä¸ƒã€ å¸¸è§é—®é¢˜æ·±åº¦è§£æ

### 7.1 â“ Task.Run ä¸çº¿ç¨‹æ± çš„å…³ç³»

**é—®é¢˜ï¼šTask.Run æ˜¯å¦ä¸€å®šä¼šåˆ†é…çº¿ç¨‹ï¼Ÿ**

**ç­”æ¡ˆï¼šæ˜¯çš„ï¼ŒTask.Run ä¸€å®šä¼šä½¿ç”¨çº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚ä½† "åˆ†é…çº¿ç¨‹" â‰  "åˆ›å»ºæ–°çº¿ç¨‹"ã€‚**

```csharp
// éªŒè¯ä»£ç 
await Task.Run(() =>
{
    var thread = Thread.CurrentThread;
    Console.WriteLine($"Task.Run çº¿ç¨‹ä¿¡æ¯:");
    Console.WriteLine($"  - ManagedThreadId: {thread.ManagedThreadId}");
    Console.WriteLine($"  - IsThreadPoolThread: {thread.IsThreadPoolThread}"); // True
    Console.WriteLine($"  - IsBackground: {thread.IsBackground}"); // True
});
```

**é—®é¢˜ï¼šå¦‚æœçº¿ç¨‹æ± æ»¡äº†ï¼ŒTask.Run ä¼šæ€æ ·ï¼Ÿ**

**ç­”æ¡ˆï¼šä»»åŠ¡ä¼šè¢«æ’é˜Ÿç­‰å¾…ï¼Œä¸ä¼šå¤±è´¥ï¼**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ThreadPool æ»¡æ—¶çš„è¡Œä¸º                             â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å…¨å±€ä»»åŠ¡é˜Ÿåˆ—                               â”‚   â”‚
â”‚  â”‚   [Task1][Task2][Task3][Task4][Task5][Task6]....             â”‚   â”‚
â”‚  â”‚       â†‘                                                      â”‚   â”‚
â”‚  â”‚   æ–°ä»»åŠ¡ä¸æ–­åŠ å…¥é˜Ÿåˆ—                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å·¥ä½œçº¿ç¨‹ (å‡è®¾Max=4)                       â”‚   â”‚
â”‚  â”‚   [Thread1: å¿™] [Thread2: å¿™] [Thread3: å¿™] [Thread4: å¿™]    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   æ‰€æœ‰çº¿ç¨‹éƒ½å¿™ç¢Œï¼Ÿâ†’ ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…                           â”‚   â”‚
â”‚  â”‚   æœ‰çº¿ç¨‹ç©ºé—²ï¼Ÿâ†’ ä»é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œ                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  ç»“æœï¼š                                                              â”‚
â”‚  â†’ ä»»åŠ¡ç»§ç»­æ’é˜Ÿï¼Œç­‰å¾…æœ‰çº¿ç¨‹ç©ºé—²                                      â”‚
â”‚  â†’ ä¸ä¼šæŠ›å¼‚å¸¸ï¼Œä¸ä¼šæ‹’ç»ä»»åŠ¡                                          â”‚
â”‚  â†’ ä½†ä¼šå¯¼è‡´å»¶è¿Ÿå¢åŠ ï¼                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 âš”ï¸ await vs .Result çš„åŒºåˆ«

| ç‰¹æ€§ | `await` | `.Result` / `.Wait()` |
|------|---------|----------------------|
| **é˜»å¡çº¿ç¨‹** | âŒ ä¸é˜»å¡ | âœ… é˜»å¡ |
| **å¼‚å¸¸ç±»å‹** | åŸå§‹å¼‚å¸¸ | `AggregateException` |
| **æ­»é”é£é™©** | ä½ | âš ï¸ é«˜ï¼ˆå°¤å…¶åœ¨ UI/ASP.NET ä¸­ï¼‰ |
| **æ€§èƒ½** | å¥½ï¼ˆçº¿ç¨‹å¯å¤ç”¨ï¼‰ | å·®ï¼ˆçº¿ç¨‹è¢«å ç”¨ï¼‰ |
| **ä½¿ç”¨åœºæ™¯** | å¼‚æ­¥æ–¹æ³•ä¸­ | Main æ–¹æ³•/.NET Core æ§åˆ¶å° |

**æ­»é”åœºæ™¯ï¼š**
```csharp
// âŒ ç»å…¸æ­»é”åœºæ™¯ (WinForms/WPF/æ—§ç‰ˆASP.NET)
public void Button_Click(object sender, EventArgs e)
{
    var result = GetDataAsync().Result;  // æ­»é”ï¼
    // UIçº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…Taskå®Œæˆ
    // ä½†Taskå®Œæˆåéœ€è¦å›åˆ°UIçº¿ç¨‹æ‰§è¡Œåç»­ä»£ç 
    // UIçº¿ç¨‹åœ¨ç­‰å¾… â†’ Taskç­‰å¾…UIçº¿ç¨‹ â†’ æ­»é”
}

// âœ… æ­£ç¡®åšæ³•ï¼šä½¿ç”¨ async/await
public async void Button_Click(object sender, EventArgs e)
{
    var result = await GetDataAsync();  // ä¸é˜»å¡
}
```

### 7.3 ğŸ˜´ Thread.Sleep vs Task.Delay

```
Thread.Sleep(1000):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹çŠ¶æ€:  è¿è¡Œ â”€â”€â”€â”€â”€â”€â–º é˜»å¡(ç¡çœ ) â”€â”€â”€â”€â”€â”€â–º è¿è¡Œ              â”‚
â”‚                         â†‘                                   â”‚
â”‚                    çº¿ç¨‹è¢«å†»ç»“                                â”‚
â”‚                    æ— æ³•åšä»»ä½•äº‹                              â”‚
â”‚                    1ç§’åæ‰èƒ½ç»§ç»­                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

await Task.Delay(1000):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹çŠ¶æ€:  è¿è¡Œ â”€â”€â”€â”€â”€â”€â–º é‡Šæ”¾å›çº¿ç¨‹æ±  â”€â”€â”€â”€â”€â”€â–º (å¯èƒ½ä¸åŒçº¿ç¨‹)è¿è¡Œ â”‚
â”‚                         â†‘                                   â”‚
â”‚                    çº¿ç¨‹è¿”å›çº¿ç¨‹æ±                              â”‚
â”‚                    å¯ä»¥å¤„ç†å…¶ä»–ä»»åŠ¡                           â”‚
â”‚                    1ç§’ååœ¨ä»»æ„ç©ºé—²çº¿ç¨‹æ¢å¤                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| åœºæ™¯ | Thread.Sleep | Task.Delay |
|------|--------------|------------|
| å¼‚æ­¥æ–¹æ³•ä¸­ | âŒ ä¸è¦ç”¨ | âœ… æ¨è |
| é«˜å¹¶å‘æœåŠ¡å™¨ | âŒ ç»å¯¹ä¸è¦ | âœ… å¿…é¡»ç”¨ |
| éœ€è¦å–æ¶ˆæ”¯æŒ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ CancellationToken |

### 7.4 ğŸ”§ ConfigureAwait çš„ä½œç”¨

```csharp
// é»˜è®¤è¡Œä¸º: ConfigureAwait(true)
await SomeAsync();  // await å®Œæˆåï¼Œå›åˆ°åŸæ¥çš„ä¸Šä¸‹æ–‡ï¼ˆå¦‚ UI çº¿ç¨‹ï¼‰

// ConfigureAwait(false): ä¸æ•è·ä¸Šä¸‹æ–‡
await SomeAsync().ConfigureAwait(false);  // å¯èƒ½åœ¨ä»»æ„çº¿ç¨‹æ± çº¿ç¨‹ä¸Šæ¢å¤
```

**ä½•æ—¶ä½¿ç”¨ï¼Ÿ**

| åœºæ™¯ | æ˜¯å¦ä½¿ç”¨ ConfigureAwait(false) | åŸå›  |
|------|-------------------------------|------|
| **ç±»åº“ä»£ç ** | âœ… æ¨èä½¿ç”¨ | åº“ä¸çŸ¥é“è°ƒç”¨è€…çš„ä¸Šä¸‹æ–‡ï¼Œé¿å…æ­»é” |
| **ASP.NET Core** | âš ï¸ å¯é€‰ | æ²¡æœ‰åŒæ­¥ä¸Šä¸‹æ–‡ï¼Œæ•ˆæœä¸€æ · |
| **WinForms/WPF æ›´æ–° UI** | âŒ ä¸è¦ä½¿ç”¨ | éœ€è¦å›åˆ° UI çº¿ç¨‹ |

### 7.5 ğŸ”€ WhenAll vs WaitAll vs WhenAny/WaitAny

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Task ç­‰å¾…æ–¹æ³•å¯¹æ¯”                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    æ–¹æ³•       â”‚   é˜»å¡çº¿ç¨‹    â”‚   è¿”å›ç±»å‹    â”‚   ç­‰å¾…è¡Œä¸º            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WhenAll      â”‚   âŒ ä¸é˜»å¡   â”‚   Task       â”‚   å¼‚æ­¥ç­‰å¾…å…¨éƒ¨å®Œæˆ    â”‚
â”‚ WaitAll      â”‚   âœ… é˜»å¡     â”‚   void       â”‚   åŒæ­¥ç­‰å¾…å…¨éƒ¨å®Œæˆ    â”‚
â”‚ WhenAny      â”‚   âŒ ä¸é˜»å¡   â”‚   Task<Task> â”‚   å¼‚æ­¥ç­‰å¾…ä»»ä¸€å®Œæˆ    â”‚
â”‚ WaitAny      â”‚   âœ… é˜»å¡     â”‚   int(ç´¢å¼•)   â”‚   åŒæ­¥ç­‰å¾…ä»»ä¸€å®Œæˆ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¨èç”¨æ³•ï¼š**
```csharp
// âœ… æ¨èï¼šå¼‚æ­¥ç­‰å¾…
await Task.WhenAll(task1, task2, task3);
var first = await Task.WhenAny(task1, task2, task3);

// âš ï¸ è°¨æ…ï¼šåŒæ­¥é˜»å¡
Task.WaitAll(task1, task2, task3);  // é˜»å¡å½“å‰çº¿ç¨‹
int index = Task.WaitAny(task1, task2, task3);  // é˜»å¡å½“å‰çº¿ç¨‹
```

### 7.6 ğŸš„ Parallel å¹¶è¡Œç¼–ç¨‹

```csharp
// Parallel.For - å¹¶è¡Œå¾ªç¯
Parallel.For(0, 100, i =>
{
    // å¹¶è¡Œæ‰§è¡Œçš„ä»£ç 
    ProcessItem(i);
});

// Parallel.ForEach - å¹¶è¡Œéå†
Parallel.ForEach(items, item =>
{
    ProcessItem(item);
});

// æ§åˆ¶å¹¶è¡Œåº¦
var options = new ParallelOptions
{
    MaxDegreeOfParallelism = 4  // æœ€å¤š4ä¸ªçº¿ç¨‹å¹¶è¡Œ
};
Parallel.ForEach(items, options, item => ProcessItem(item));
```

**é€‚ç”¨åœºæ™¯ï¼š**

| åœºæ™¯ | é€‚åˆä½¿ç”¨ Parallel | åŸå›  |
|------|------------------|------|
| å›¾åƒæ‰¹é‡å¤„ç† | âœ… | CPU å¯†é›†ï¼Œæ•°æ®ç‹¬ç«‹ |
| å¤§æ•°æ®è®¡ç®— | âœ… | å……åˆ†åˆ©ç”¨å¤šæ ¸ |
| æ‰¹é‡ HTTP è¯·æ±‚ | âŒ | I/O å¯†é›†ï¼Œåº”ç”¨ async |
| æ•°æ®åº“æ‰¹é‡æŸ¥è¯¢ | âŒ | I/O å¯†é›†ï¼Œåº”ç”¨ async |

> ğŸ’¡ **å°ç»“**ï¼šç†è§£è¿™äº›å¸¸è§é—®é¢˜çš„ç­”æ¡ˆæ˜¯æŒæ¡ .NET å¼‚æ­¥ç¼–ç¨‹çš„å…³é”®ã€‚è®°ä½ï¼šawait ä¸é˜»å¡ã€Task.Delay ä¸å çº¿ç¨‹ã€ConfigureAwait(false) ç”¨äºåº“ä»£ç ã€WhenAll ä¼˜äº WaitAllã€‚

---

## å…«ã€ ğŸš¦ ä¿¡å·é‡ä¸å¹¶å‘æ§åˆ¶

### 8.1 ğŸ¤” ä¿¡å·é‡æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šçº¿ç¨‹æ± å’Œä¿¡å·é‡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**

```
çº¿ç¨‹æ± æ§åˆ¶:  æ§åˆ¶çš„æ˜¯ "æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ•°"
ä¿¡å·é‡æ§åˆ¶:  æ§åˆ¶çš„æ˜¯ "åŒæ—¶è¿›è¡ŒæŸä¸ªæ“ä½œçš„å¹¶å‘æ•°"

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœºæ™¯: è°ƒç”¨ç¬¬ä¸‰æ–¹ APIï¼Œé™åˆ¶å¹¶å‘è¯·æ±‚æ•°ä¸º 10                            â”‚
â”‚                                                                     â”‚
â”‚  çº¿ç¨‹æ± æœ‰ 100 ä¸ªçº¿ç¨‹ï¼Œä½†ä½ åªæƒ³åŒæ—¶å‘ 10 ä¸ªè¯·æ±‚                        â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SemaphoreSlim(10)                              â”‚    â”‚
â”‚  â”‚                    â”‚                                        â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚1] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º API                            â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚2] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º API                            â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚3] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º API                            â”‚    â”‚
â”‚  â”‚   ...              â”‚         (æœ€å¤š10ä¸ªåŒæ—¶è¿›è¡Œ)              â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚10] â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â–º API                            â”‚    â”‚
â”‚  â”‚                    â”‚                                        â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚11] â”€â”€â”€â”€â”€â”€â”€â”€â”¼ ç­‰å¾…... (ä¿¡å·é‡å·²æ»¡)                    â”‚    â”‚
â”‚  â”‚   [è¯·æ±‚12] â”€â”€â”€â”€â”€â”€â”€â”€â”¼ ç­‰å¾…...                                â”‚    â”‚
â”‚  â”‚                    â”‚                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 ğŸ’» SemaphoreSlim ä½¿ç”¨ç¤ºä¾‹

```csharp
using System;
using System.Net.Http;
using System.Threading;
using System.Threading.Tasks;
using System.Linq;

class SemaphoreDemo
{
    private static readonly SemaphoreSlim _semaphore = new SemaphoreSlim(10); // æœ€å¤š10ä¸ªå¹¶å‘
    
    static async Task Main()
    {
        var urls = Enumerable.Range(1, 100)
            .Select(i => $"https://api.example.com/data/{i}")
            .ToList();
        
        using var client = new HttpClient();
        
        var tasks = urls.Select(async url =>
        {
            await _semaphore.WaitAsync();  // è·å–ä¿¡å·é‡
            try
            {
                return await client.GetStringAsync(url);
            }
            finally
            {
                _semaphore.Release();  // é‡Šæ”¾ä¿¡å·é‡
            }
        });
        
        await Task.WhenAll(tasks);
    }
}
```

### 8.3 ğŸ¯ ä¿¡å·é‡ vs çº¿ç¨‹æ±  èŒè´£å¯¹æ¯”

```
                    é—®é¢˜: å¦‚ä½•æ§åˆ¶å¹¶å‘ï¼Ÿ
                              â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                               â”‚
              â–¼                               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   ThreadPool    â”‚           â”‚  SemaphoreSlim   â”‚
     â”‚   çº¿ç¨‹æ± é…ç½®     â”‚           â”‚   ä¿¡å·é‡         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ æ§åˆ¶ "æœ‰å¤šå°‘çº¿ç¨‹  â”‚           â”‚ æ§åˆ¶ "æœ‰å¤šå°‘ä»»åŠ¡  â”‚
     â”‚ åœ¨åŒæ—¶æ‰§è¡Œä»»åŠ¡"   â”‚           â”‚ åœ¨åŒæ—¶è®¿é—®èµ„æº"   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ å…¨å±€è®¾ç½®         â”‚           â”‚ é’ˆå¯¹ç‰¹å®šèµ„æº     â”‚
     â”‚ å½±å“æ‰€æœ‰ä»»åŠ¡      â”‚           â”‚ ç»†ç²’åº¦æ§åˆ¶       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.4 âœ… ä¿¡å·é‡é€‚ç”¨åœºæ™¯

| åœºæ™¯ | éœ€è¦ä¿¡å·é‡ | åŸå›  |
|------|-----------|------|
| ç¬¬ä¸‰æ–¹ API æœ‰é¢‘ç‡é™åˆ¶ | âœ… | é¿å…è§¦å‘é™æµ |
| æ•°æ®åº“è¿æ¥æ± æœ‰é™ | âœ… | é˜²æ­¢è¿æ¥è€—å°½ |
| æ–‡ä»¶ç³»ç»Ÿ I/O éœ€è¦é™åˆ¶ | âœ… | é¿å…åŒæ—¶æ‰“å¼€å¤ªå¤šæ–‡ä»¶ |
| å¤–éƒ¨æœåŠ¡æ‰¿å—èƒ½åŠ›æœ‰é™ | âœ… | ä¿æŠ¤ä¸‹æ¸¸æœåŠ¡ |
| çº¯ CPU è®¡ç®—ä»»åŠ¡ | âŒ | ç”¨ Parallel.ForEach |
| åªæƒ³é™åˆ¶çº¿ç¨‹æ± çº¿ç¨‹æ•° | âŒ | é…ç½® ThreadPool |

### 8.5 ğŸ†š Semaphore vs SemaphoreSlim

| ç‰¹æ€§ | SemaphoreSlim | Semaphore |
|------|---------------|-----------|
| **æ€§èƒ½** | ğŸš€ æ›´å¿«ï¼ˆç”¨æˆ·æ¨¡å¼ï¼‰ | ğŸ¢ è¾ƒæ…¢ï¼ˆå†…æ ¸æ¨¡å¼ï¼‰ |
| **è·¨è¿›ç¨‹** | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| **å¼‚æ­¥ç­‰å¾…** | âœ… WaitAsync() | âŒ åªæœ‰ WaitOne() |
| **æ¨èç¨‹åº¦** | âœ… .NET Core é¦–é€‰ | âš ï¸ ç‰¹æ®Šåœºæ™¯ |

> ğŸ’¡ **å°ç»“**ï¼šä¿¡å·é‡åœ¨ .NET Core ä¸­ç»å¯¹æœ‰å¿…è¦ï¼å®ƒè§£å†³çš„æ˜¯"é™åˆ¶å¯¹ç‰¹å®šèµ„æºçš„å¹¶å‘è®¿é—®"é—®é¢˜ï¼Œä¸çº¿ç¨‹æ± æ§åˆ¶çš„"çº¿ç¨‹æ•°é‡"æ˜¯ä¸åŒç»´åº¦ã€‚å¼‚æ­¥ I/O ä¸å ç”¨çº¿ç¨‹ï¼Œæ‰€ä»¥çº¿ç¨‹æ± é…ç½®æ— æ³•é™åˆ¶å¼‚æ­¥æ“ä½œçš„å¹¶å‘æ•°ï¼Œå¿…é¡»ç”¨ä¿¡å·é‡ã€‚

---

## ä¹ã€ ğŸ“Š æ€§èƒ½å¯¹æ¯”ä¸æœ€ä½³å®è·µ

### 9.1 ğŸƒ æ€§èƒ½å¯¹æ¯”è¡¨

| æŒ‡æ ‡ | Thread | ThreadPool | Task | async/await |
|------|--------|------------|------|-------------|
| **åˆ›å»ºå¼€é”€** | ~200,000 CPU cycles | ~å‡ ç™¾ cycles | ~å‡ ç™¾ cycles | ~çŠ¶æ€æœºå¼€é”€ |
| **å†…å­˜å ç”¨/ä¸ª** | ~1MB (æ ˆ) | å¤ç”¨ | å¤ç”¨ | æä½ (~100-200å­—èŠ‚) |
| **10000æ¬¡æ‰§è¡Œ** | ~5000ms | ~100ms | ~100ms | ~10ms |
| **ä¸Šä¸‹æ–‡åˆ‡æ¢** | é«˜ | ä¸­ | ä¸­ | ä½ |
| **é€‚åˆçŸ­ä»»åŠ¡** | âŒ | âœ… | âœ… | âœ… |
| **é€‚åˆé•¿ä»»åŠ¡** | âœ… | âš ï¸ | âœ… | âœ… |

### 9.2 ğŸ“ˆ èµ„æºæ¶ˆè€—å›¾ç¤º

```
å†…å­˜æ¶ˆè€— (æ¯ä¸ªå¹¶å‘å•ä½):

Thread:      [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] ~1MB
ThreadPool:  [â–ˆâ–ˆâ–ˆâ–ˆ]                              å¤ç”¨
Task:        [â–ˆâ–ˆâ–ˆâ–ˆ]                              å¤ç”¨
async/await: [â–ˆ]                                 çŠ¶æ€æœºçº¦100-200å­—èŠ‚

CPU å¼€é”€ (åˆ›å»º/è°ƒåº¦):

Thread:      [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ] æœ€é«˜
ThreadPool:  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]                                  ä¸­ç­‰
Task:        [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]                                  ä¸­ç­‰
async/await: [â–ˆâ–ˆâ–ˆâ–ˆ]                                      æœ€ä½ (å¦‚æœ Task å·²å®Œæˆ)
```

### 9.3 ğŸ§­ é€‰æ‹©å†³ç­–æµç¨‹å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚      ä½ éœ€è¦å¹¶å‘æ‰§è¡Œå—ï¼Ÿ    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ æ˜¯                    â”‚ å¦
                    â–¼                       â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ˜¯ I/O å¯†é›†å‹ï¼Ÿ  â”‚        â”‚  åŒæ­¥æ‰§è¡Œå³å¯   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ æ˜¯              â”‚ å¦ (CPUå¯†é›†å‹)
         â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚async/awaitâ”‚     â”‚ éœ€è¦ç²¾ç¡®æ§åˆ¶çº¿ç¨‹ï¼Ÿ â”‚
    â”‚ (é¦–é€‰)   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ æ˜¯              â”‚ å¦
                     â–¼                 â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Thread   â”‚      â”‚Task.Run  â”‚
              â”‚  (ç›´æ¥)   â”‚      â”‚/Parallel â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.4 ğŸ“‹ åœºæ™¯å¯¹ç…§è¡¨

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ | åŸå›  |
|------|----------|------|
| ğŸŒ HTTP è¯·æ±‚ | `async/await` + `HttpClient` | I/O æ“ä½œï¼Œä¸é˜»å¡çº¿ç¨‹ |
| ğŸ“ æ–‡ä»¶è¯»å†™ | `async/await` + `StreamReader/Writer` | I/O æ“ä½œ |
| ğŸ—„ï¸ æ•°æ®åº“æŸ¥è¯¢ | `async/await` + å¼‚æ­¥ ORM | I/O æ“ä½œ |
| ğŸ–¼ï¸ å›¾åƒå¤„ç† | `Task.Run` / `Parallel.ForEach` | CPU å¯†é›†å‹ |
| ğŸ“Š å¤§é‡çŸ­å°è®¡ç®— | `Parallel.ForEach` / `PLINQ` | è‡ªåŠ¨è´Ÿè½½å‡è¡¡ |
| â° åå°å®šæ—¶ä»»åŠ¡ | `Task` + `Timer` æˆ– `BackgroundService` | é•¿æ—¶é—´è¿è¡Œ |
| ğŸšï¸ éœ€è¦çº¿ç¨‹ä¼˜å…ˆçº§ | `Thread` | å”¯ä¸€æ”¯æŒä¼˜å…ˆçº§çš„æ–¹å¼ |
| ğŸ–¥ï¸ GUI å“åº” | `async/await` | ä¿æŒ UI å“åº” |

### 9.5 âœ¨ æœ€ä½³å®è·µæ€»ç»“

```csharp
// âœ… 1. ä¼˜å…ˆä½¿ç”¨ async/await å¤„ç† I/O æ“ä½œ
public async Task<string> GetDataAsync()
{
    using var client = new HttpClient();
    return await client.GetStringAsync("https://api.example.com");
}

// âœ… 2. CPU å¯†é›†å‹ä»»åŠ¡ç”¨ Task.Run
public async Task ProcessAsync()
{
    var result = await Task.Run(() => HeavyComputation());
}

// âœ… 3. é¿å… async void (é™¤äº‹ä»¶å¤„ç†ç¨‹åºå¤–)
public async Task DoWorkAsync() { } // æ­£ç¡®
// public async void DoWorkAsync() { } // é”™è¯¯ï¼

// âœ… 4. ä¸è¦æ··ç”¨åŒæ­¥å’Œå¼‚æ­¥ï¼Œé¿å… .Result å’Œ .Wait()
var result = await GetDataAsync(); // æ­£ç¡®
// var result = GetDataAsync().Result; // å±é™©ï¼å¯èƒ½æ­»é”

// âœ… 5. åº“ä»£ç ä¸­ä½¿ç”¨ ConfigureAwait(false)
public async Task LibraryMethodAsync()
{
    await SomeOperationAsync().ConfigureAwait(false);
}

// âœ… 6. ä½¿ç”¨ CancellationToken æ”¯æŒå–æ¶ˆ
public async Task DoWorkAsync(CancellationToken ct)
{
    await Task.Delay(1000, ct);
}

// âœ… 7. å¹¶è¡Œæ‰§è¡Œç‹¬ç«‹çš„å¼‚æ­¥ä»»åŠ¡
var task1 = GetData1Async();
var task2 = GetData2Async();
await Task.WhenAll(task1, task2);

// âœ… 8. ä½¿ç”¨ä¿¡å·é‡æ§åˆ¶å¹¶å‘è®¿é—®å¤–éƒ¨èµ„æº
private readonly SemaphoreSlim _semaphore = new(10);
await _semaphore.WaitAsync();
try { /* è®¿é—®èµ„æº */ }
finally { _semaphore.Release(); }
```

> ğŸ’¡ **å°ç»“**ï¼šé€‰æ‹©åˆé€‚çš„å¹¶å‘æ–¹æ¡ˆæ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚I/O å¯†é›†ç”¨ async/awaitï¼ŒCPU å¯†é›†ç”¨ Task.Run/Parallelï¼Œéœ€è¦ç²¾ç¡®æ§åˆ¶ç”¨ Threadï¼Œé™åˆ¶å¹¶å‘ç”¨ SemaphoreSlimã€‚

---

## åã€ ğŸ”„ .NET Framework vs .NET Core å·®å¼‚

### 10.1 ğŸ”§ çº¿ç¨‹æ± æ”¹è¿›

| ç‰¹æ€§ | .NET Framework | .NET Core / .NET 5+ |
|------|----------------|---------------------|
| **çº¿ç¨‹æ± ç®—æ³•** | åŸºäºæ—¶é—´çš„è°ƒæ•´ | Hill Climbing ç®—æ³• |
| **æœ€å°çº¿ç¨‹æ•°** | CPU æ ¸å¿ƒæ•° | æ›´æ™ºèƒ½çš„åŠ¨æ€è°ƒæ•´ |
| **çº¿ç¨‹åˆ›å»ºé€Ÿåº¦** | æ¯ç§’çº¦1-2ä¸ªæ–°çº¿ç¨‹ | æ›´å¿«çš„å“åº” |
| **I/O å®Œæˆç«¯å£** | æ”¯æŒ | ä¼˜åŒ–çš„å®ç° |
| **å·¥ä½œçªƒå–** | æœ‰é™æ”¯æŒ | å®Œæ•´æ”¯æŒ |

### 10.2 âœ¨ async/await æ”¹è¿›

```
.NET Framework 4.5 â†’ .NET Core 3.1 â†’ .NET 5/6/7/8 çš„æ”¹è¿›ï¼š

æ€§èƒ½æå‡:
â”œâ”€â”€ ValueTask<T> å‡å°‘å †åˆ†é…
â”œâ”€â”€ IValueTaskSource è‡ªå®šä¹‰å¼‚æ­¥æº
â”œâ”€â”€ æ›´å°‘çš„çŠ¶æ€æœºè£…ç®±
â””â”€â”€ ConfigureAwait ä¼˜åŒ–

æ–°åŠŸèƒ½:
â”œâ”€â”€ IAsyncEnumerable<T> (å¼‚æ­¥æµ)
â”œâ”€â”€ IAsyncDisposable (å¼‚æ­¥é‡Šæ”¾)
â”œâ”€â”€ await foreach
â””â”€â”€ await using
```

### 10.3 ğŸ’» æ–°åŠŸèƒ½ä»£ç ç¤ºä¾‹

```csharp
// === .NET Core 2.1+ : ValueTask ===
// å½“ç»“æœå¯èƒ½åŒæ­¥å¯ç”¨æ—¶ï¼Œé¿å… Task çš„å †åˆ†é…
public ValueTask<int> GetCachedValueAsync(string key)
{
    if (_cache.TryGetValue(key, out int value))
    {
        return new ValueTask<int>(value); // æ— å †åˆ†é…
    }
    return new ValueTask<int>(FetchFromDatabaseAsync(key));
}

// === C# 8.0 / .NET Core 3.0+ : å¼‚æ­¥æµ ===
public async IAsyncEnumerable<User> GetUsersAsync(
    [EnumeratorCancellation] CancellationToken ct = default)
{
    int page = 0;
    while (true)
    {
        var users = await _repository.GetPageAsync(page++, ct);
        if (users.Count == 0) break;
        
        foreach (var user in users)
        {
            yield return user;
        }
    }
}

// æ¶ˆè´¹å¼‚æ­¥æµ
await foreach (var user in GetUsersAsync())
{
    Console.WriteLine(user.Name);
}

// === C# 8.0+ : å¼‚æ­¥é‡Šæ”¾ ===
public class AsyncResource : IAsyncDisposable
{
    public async ValueTask DisposeAsync()
    {
        await CleanupAsync();
    }
}

// ä½¿ç”¨
await using var resource = new AsyncResource();
```

> ğŸ’¡ **å°ç»“**ï¼š.NET Core å¯¹å¼‚æ­¥ç¼–ç¨‹è¿›è¡Œäº†å¤§é‡ä¼˜åŒ–ï¼ŒåŒ…æ‹¬æ›´æ™ºèƒ½çš„çº¿ç¨‹æ± è°ƒåº¦ã€ValueTask å‡å°‘å†…å­˜åˆ†é…ã€å¼‚æ­¥æµç­‰æ–°ç‰¹æ€§ã€‚å»ºè®®æ–°é¡¹ç›®ä½¿ç”¨ .NET 6+ ä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚

---

## ğŸ“š ç»ˆæå¯¹æ¯”æ€»ç»“è¡¨

| ç»´åº¦ | Thread | ThreadPool | Task | async/await |
|------|--------|------------|------|-------------|
| **å¼•å…¥ç‰ˆæœ¬** | .NET 1.0 | .NET 1.0 | .NET 4.0 | .NET 4.5 |
| **æŠ½è±¡å±‚çº§** | æœ€ä½ | ä½ | ä¸­ | é«˜ |
| **åˆ›å»ºå¼€é”€** | ğŸ”´ é«˜ | ğŸŸ¢ ä½ | ğŸŸ¢ ä½ | ğŸŸ¢ æœ€ä½ |
| **å†…å­˜å ç”¨** | ğŸ”´ é«˜ (~1MB) | ğŸŸ¢ å¤ç”¨ | ğŸŸ¢ å¤ç”¨ | ğŸŸ¢ æä½ |
| **çº¿ç¨‹æ§åˆ¶** | âœ… å®Œå…¨æ§åˆ¶ | âš ï¸ æœ‰é™ | âš ï¸ æœ‰é™ | âŒ æ—  |
| **ä¼˜å…ˆçº§è®¾ç½®** | âœ… | âŒ | âŒ | âŒ |
| **å–æ¶ˆæ”¯æŒ** | âš ï¸ æ‰‹åŠ¨ | âš ï¸ æ‰‹åŠ¨ | âœ… CancellationToken | âœ… |
| **å¼‚å¸¸å¤„ç†** | âš ï¸ æ‰‹åŠ¨ | âš ï¸ å›°éš¾ | âœ… AggregateException | âœ… è‡ªç„¶ |
| **è¿”å›å€¼** | âš ï¸ å›°éš¾ | âš ï¸ å›°éš¾ | âœ… Task\<T\> | âœ… |
| **ç»„åˆèƒ½åŠ›** | âŒ æ—  | âŒ æ—  | âœ… WhenAll/WhenAny | âœ… |
| **I/O æ“ä½œ** | ğŸ”´ æµªè´¹çº¿ç¨‹ | ğŸ”´ æµªè´¹çº¿ç¨‹ | âš ï¸ å¯ä»¥ä½†ä¸æ¨è | âœ… æœ€ä½³ |
| **CPU æ“ä½œ** | âœ… | âœ… | âœ… | âš ï¸ éœ€é…åˆTask.Run |
| **æ¨èç¨‹åº¦** | âš ï¸ ç‰¹æ®Šåœºæ™¯ | âš ï¸ åº•å±‚åœºæ™¯ | âœ… æ¨è | âœ…âœ… é¦–é€‰ |

---

## ğŸ¯ ç»“è¯­

æŒæ¡ .NET å¤šçº¿ç¨‹å’Œå¼‚æ­¥ç¼–ç¨‹æ˜¯æˆä¸ºé«˜çº§å¼€å‘è€…çš„å¿…ç»ä¹‹è·¯ã€‚æ ¸å¿ƒè¦ç‚¹ï¼š

1. **ä¼˜å…ˆä½¿ç”¨ `async/await`**ï¼šç°ä»£ .NET å¼€å‘çš„é¦–é€‰
2. **ç†è§£çº¿ç¨‹æ± **ï¼šçŸ¥é“ä»»åŠ¡å¦‚ä½•è¢«è°ƒåº¦æ‰§è¡Œ
3. **åŒºåˆ† I/O å¯†é›†å’Œ CPU å¯†é›†**ï¼šé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ
4. **é¿å…å¸¸è§é™·é˜±**ï¼šä¸è¦ .Resultã€ä¸è¦ async voidã€åˆç†ä½¿ç”¨ ConfigureAwait
5. **å–„ç”¨ä¿¡å·é‡**ï¼šæ§åˆ¶å¯¹å¤–éƒ¨èµ„æºçš„å¹¶å‘è®¿é—®

> ğŸš€ **è®°ä½**ï¼šå¼‚æ­¥ä¸æ˜¯ä¸ºäº†å¿«ï¼Œè€Œæ˜¯ä¸ºäº†åœ¨ç­‰å¾…æ—¶ä¸æµªè´¹èµ„æºï¼

---


